<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="ja" lang="ja">
  <head>

    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
    <meta name="viewport"    content="width=device-width, initial-scale=1"/>
    <meta name="description" content="Railsガイドは、Ruby on Rails Guidesに基づいた大型リファレンスガイドです。Rails開発の生産性を高めたいときや、Railsの各機能を体系的に学びたいときに役立ちます。" />
    <meta name="keywords"    content="Ruby Rails ガイド 体系的 入門 無料" />
    <meta name="author"      content="Ruby on Rails Community" />

    <meta property="fb:admins"      content="715330868" />
    <meta property="og:title"       content="Ruby on Rails ガイド：体系的に Rails を学ぼう"/>
    <meta property="og:site_name"   content="Ruby on Rails ガイド：体系的に Rails を学ぼう"/>
    <meta property="og:image"       content="https://railsguides.jp/images/cover_for_facebook.png"/>
    <meta property="og:url"         content="https://railsguides.jp/" />
    <meta property="og:type"        content="article" />
    <meta property="og:description" content="Railsガイドは、Ruby on Rails Guidesに基づいた大型リファレンスガイドです。Rails開発の生産性を高めたいときや、Railsの各機能を体系的に学びたいときに役立ちます。" />

    <meta name="twitter:card"  content="summary" />
    <meta name="twitter:site"  content="@RailsGuidesJP" />
    <meta name="twitter:title" content="Ruby on Rails ガイド：体系的に Rails を学ぼう" />
    <meta name="twitter:description" content="Railsガイドは、Ruby on Rails Guidesに基づいた大型リファレンスガイドです。Rails開発の生産性を高めたいときや、Railsの各機能を体系的に学びたいときに役立ちます。" />
    <meta name="twitter:image" content="https://railsguides.jp/images/cover_for_twitter.png" />
    <meta name="twitter:url"   content="https://railsguides.jp/" />

    <title>レイアウトとレンダリング | Rails ガイド</title>
    <meta name="apple-mobile-web-app-title" content="Railsガイド" />
    <meta name="application-name"           content="Railsガイド" />

    <link rel="stylesheet" type="text/css" href="stylesheets/style.css" />
    <link rel="stylesheet" type="text/css" href="stylesheets/print.css" media="print" />
    <link rel="stylesheet" type="text/css" href="stylesheets/syntaxhighlighter/shCore.css" />
    <link rel="stylesheet" type="text/css" href="stylesheets/syntaxhighlighter/shThemeRailsGuides.css" />
    <link rel="stylesheet" type="text/css" href="stylesheets/fixes.css" />

    <link href="images/favicon.ico" rel="shortcut icon" type="image/x-icon" />

    <link rel="apple-touch-icon" sizes="57x57" href="images/favicons/apple-icon-57x57.png">
    <link rel="apple-touch-icon" sizes="60x60" href="images/favicons/apple-icon-60x60.png">
    <link rel="apple-touch-icon" sizes="72x72" href="images/favicons/apple-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="76x76" href="images/favicons/apple-icon-76x76.png">
    <link rel="apple-touch-icon" sizes="114x114" href="images/favicons/apple-icon-114x114.png">
    <link rel="apple-touch-icon" sizes="120x120" href="images/favicons/apple-icon-120x120.png">
    <link rel="apple-touch-icon" sizes="144x144" href="images/favicons/apple-icon-144x144.png">
    <link rel="apple-touch-icon" sizes="152x152" href="images/favicons/apple-icon-152x152.png">
    <link rel="apple-touch-icon" sizes="180x180" href="images/favicons/apple-icon-180x180.png">
    <link rel="icon" type="image/png" sizes="192x192"  href="images/favicons/android-icon-192x192.png">
    <link rel="icon" type="image/png" sizes="32x32" href="images/favicons/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="96x96" href="images/favicons/favicon-96x96.png">
    <link rel="icon" type="image/png" sizes="16x16" href="images/favicons/favicon-16x16.png">
    <link rel="manifest" href="manifest.json">
    <meta name="msapplication-TileColor" content="#ffffff">
    <meta name="msapplication-TileImage" content="images/favicons/ms-icon-144x144.png">
    <meta name="theme-color" content="#ffffff">

  </head>
<body class="guide">
  <div id="fb-root"></div>
  <script>(function(d, s, id) {
    var js, fjs = d.getElementsByTagName(s)[0];
    if (d.getElementById(id)) return;
    js = d.createElement(s); js.id = id;
    js.src = "//connect.facebook.net/en_US/sdk.js#xfbml=1&appId=614116885378153&version=v2.0";
    fjs.parentNode.insertBefore(js, fjs);
    }(document, 'script', 'facebook-jssdk'));</script>
  <div id="topNav">
    <div class="wrapper">
      <strong class="more-info-label">関連サイト: </strong>
      <span class="red-button more-info-button">関連URL</span>
      <ul class="more-info-links s-hidden">
        <li class="more-info"><a href="http://guides.rubyonrails.org/">原著 (英語)</a></li>
        <li class="more-info"><a href="https://github.com/yasslab/railsguides.jp">ソースコード (GitHub)</a></li>
        <li class="more-info"><a href="https://railstutorial.jp/">Rails チュートリアル</a></li>
      </ul>
    </div>
  </div>
  <div id="header">
    <div class="wrapper clearfix">
      <h1><a href="/" title="Return to home page">railsguides.jp</a></h1>
      <ul class="nav">
        <li><a class="nav-item" href="/">ホーム</a></li>
        <li class="guides-index guides-index-large">
          <a href="index.html" id="guidesMenu" class="guides-index-item nav-item">ガイド目次</a>
          <div id="guides" class="clearfix" style="display: none;">
            <hr />
              <dl class="L">
                <dt>はじめに</dt>
                <dd><a href="getting_started.html">Rails をはじめよう</a></dd>
                <dt>モデル</dt>
                <dd><a href="active_record_basics.html">Active Record の基礎</a></dd>
                <dd><a href="active_record_migrations.html">Active Record マイグレーション</a></dd>
                <dd><a href="active_record_validations.html">Active Record バリデーション</a></dd>
                <dd><a href="active_record_callbacks.html">Active Record コールバック</a></dd>
                <dd><a href="association_basics.html">Active Record の関連付け</a></dd>
                <dd><a href="active_record_querying.html">Active Record クエリインターフェイス</a></dd>
                <dd><a href="active_model_basics.html">Active Model の基礎</a></dd>
                <dt>ビュー</dt>
                <dd><a href="action_view_overview.html">Action View の概要</a></dd>
                <dd><a href="layouts_and_rendering.html">レイアウトとレンダリング</a></dd>
                <dd><a href="form_helpers.html">Action View フォームヘルパー</a></dd>
                <dt>コントローラ</dt>
                <dd><a href="action_controller_overview.html">Action Controller の概要</a></dd>
                <dd><a href="routing.html">Rails ルーティング</a></dd>
              </dl>
              <dl class="R">
                <dt>高度なトピック</dt>
                <dd><a href="active_support_core_extensions.html">Active Support コア拡張機能</a></dd>
                <dd><a href="i18n.html">Rails 国際化 (i18n) API</a></dd>
                <dd><a href="action_mailer_basics.html">Action Mailer の基礎</a></dd>
                <dd><a href="active_job_basics.html">Active Job の基礎</a></dd>
                <dd><a href="testing.html">Rails テスティングガイド</a></dd>
                <dd><a href="security.html">Rails セキュリティガイド</a></dd>
                <dd><a href="debugging_rails_applications.html">Rails アプリケーションのデバッグ</a></dd>
                <dd><a href="configuring.html">Rails アプリケーションを設定する</a></dd>
                <dd><a href="command_line.html">コマンドラインツールと Rake タスク</a></dd>
                <dd><a href="asset_pipeline.html">アセットパイプライン</a></dd>
                <dd><a href="working_with_javascript_in_rails.html">Rails で JavaScript を使用する</a></dd>
                <dd><a href="initialization.html">Rails の初期化プロセス</a></dd>
                <dd><a href="autoloading_and_reloading_constants.html">定数の自動読み込みと再読み込み</a></dd>
                <dd><a href="caching_with_rails.html">Rails のキャッシュ: 概要</a></dd>
                <dd><a href="active_support_instrumentation.html">Active Support の Instrumentation 機能</a></dd>
                <dd><a href="profiling.html">Rails アプリのプロファイリング</a></dd>
                <dd><a href="api_app.html">Rails による API 専用アプリ</a></dd>
                <dd><a href="action_cable_overview.html">Action Cable の概要</a></dd>
                <dt>Rails を拡張する</dt>
                <dd><a href="plugins.html">Rails プラグイン作成入門</a></dd>
                <dd><a href="rails_on_rack.html">Rails と Rack</a></dd>
                <dd><a href="generators.html">Rails ジェネレータとテンプレート入門</a></dd>
                <dd><a href="engines.html">Rails エンジン入門</a></dd>
                <dt>Ruby on Rails に貢献する</dt>
                <dd><a href="contributing_to_ruby_on_rails.html">Ruby on Rails に貢献する方法</a></dd>
                <dd><a href="development_dependencies_install.html">Rails コア開発環境の構築方法</a></dd>
                <dd><a href="api_documentation_guidelines.html">API ドキュメント作成ガイドライン</a></dd>
                <dd><a href="ruby_on_rails_guides_guidelines.html">Rails ガイドのガイドライン</a></dd>
                <dt>メンテナンスポリシー</dt>
                <dd><a href="maintenance_policy.html">メンテナンスポリシー</a></dd>
                <dt>リリースノート</dt>
                <dd><a href="upgrading_ruby_on_rails.html">Rails アップグレードガイド</a></dd>
                <dd><a href="5_0_release_notes.html">Ruby on Rails 5.0 リリースノート</a></dd>
                <dd><a href="4_2_release_notes.html">Ruby on Rails 4.2 リリースノート</a></dd>
                <dd><a href="4_1_release_notes.html">Ruby on Rails 4.1 リリースノート</a></dd>
                <dd><a href="4_0_release_notes.html">Ruby on Rails 4.0 リリースノート</a></dd>
                <dd><a href="3_2_release_notes.html">Ruby on Rails 3.2 Release Notes [未着手]</a></dd>
                <dd><a href="3_1_release_notes.html">Ruby on Rails 3.1 Release Notes [未着手]</a></dd>
                <dd><a href="3_0_release_notes.html">Ruby on Rails 3.0 Release Notes [未着手]</a></dd>
                <dd><a href="2_3_release_notes.html">Ruby on Rails 2.3 Release Notes [未着手]</a></dd>
                <dd><a href="2_2_release_notes.html">Ruby on Rails 2.2 Release Notes [未着手]</a></dd>
              </dl>
          </div>
        </li>
        <li><a class="nav-item" href="https://github.com/yasslab/railsguides.jp#readme">翻訳に貢献する</a></li>
        <li><a class="nav-item" href="credits.html">原著者</a></li>
        <li><a class="nav-item" href="options.html">電子書籍 (検索対応)</a></li>
        <li class="guides-index guides-index-small">
          <select class="guides-index-item nav-item">
            <option value="index.html">ガイド目次</option>
              <optgroup label="はじめに">
                  <option value="getting_started.html">Rails をはじめよう</option>
              </optgroup>
              <optgroup label="モデル">
                  <option value="active_record_basics.html">Active Record の基礎</option>
                  <option value="active_record_migrations.html">Active Record マイグレーション</option>
                  <option value="active_record_validations.html">Active Record バリデーション</option>
                  <option value="active_record_callbacks.html">Active Record コールバック</option>
                  <option value="association_basics.html">Active Record の関連付け</option>
                  <option value="active_record_querying.html">Active Record クエリインターフェイス</option>
                  <option value="active_model_basics.html">Active Model の基礎</option>
              </optgroup>
              <optgroup label="ビュー">
                  <option value="action_view_overview.html">Action View の概要</option>
                  <option value="layouts_and_rendering.html">レイアウトとレンダリング</option>
                  <option value="form_helpers.html">Action View フォームヘルパー</option>
              </optgroup>
              <optgroup label="コントローラ">
                  <option value="action_controller_overview.html">Action Controller の概要</option>
                  <option value="routing.html">Rails ルーティング</option>
              </optgroup>
              <optgroup label="高度なトピック">
                  <option value="active_support_core_extensions.html">Active Support コア拡張機能</option>
                  <option value="i18n.html">Rails 国際化 (i18n) API</option>
                  <option value="action_mailer_basics.html">Action Mailer の基礎</option>
                  <option value="active_job_basics.html">Active Job の基礎</option>
                  <option value="testing.html">Rails テスティングガイド</option>
                  <option value="security.html">Rails セキュリティガイド</option>
                  <option value="debugging_rails_applications.html">Rails アプリケーションのデバッグ</option>
                  <option value="configuring.html">Rails アプリケーションを設定する</option>
                  <option value="command_line.html">コマンドラインツールと Rake タスク</option>
                  <option value="asset_pipeline.html">アセットパイプライン</option>
                  <option value="working_with_javascript_in_rails.html">Rails で JavaScript を使用する</option>
                  <option value="initialization.html">Rails の初期化プロセス</option>
                  <option value="autoloading_and_reloading_constants.html">定数の自動読み込みと再読み込み</option>
                  <option value="caching_with_rails.html">Rails のキャッシュ: 概要</option>
                  <option value="active_support_instrumentation.html">Active Support の Instrumentation 機能</option>
                  <option value="profiling.html">Rails アプリのプロファイリング</option>
                  <option value="api_app.html">Rails による API 専用アプリ</option>
                  <option value="action_cable_overview.html">Action Cable の概要</option>
              </optgroup>
              <optgroup label="Rails を拡張する">
                  <option value="plugins.html">Rails プラグイン作成入門</option>
                  <option value="rails_on_rack.html">Rails と Rack</option>
                  <option value="generators.html">Rails ジェネレータとテンプレート入門</option>
                  <option value="engines.html">Rails エンジン入門</option>
              </optgroup>
              <optgroup label="Ruby on Rails に貢献する">
                  <option value="contributing_to_ruby_on_rails.html">Ruby on Rails に貢献する方法</option>
                  <option value="development_dependencies_install.html">Rails コア開発環境の構築方法</option>
                  <option value="api_documentation_guidelines.html">API ドキュメント作成ガイドライン</option>
                  <option value="ruby_on_rails_guides_guidelines.html">Rails ガイドのガイドライン</option>
              </optgroup>
              <optgroup label="メンテナンスポリシー">
                  <option value="maintenance_policy.html">メンテナンスポリシー</option>
              </optgroup>
              <optgroup label="リリースノート">
                  <option value="upgrading_ruby_on_rails.html">Rails アップグレードガイド</option>
                  <option value="5_0_release_notes.html">Ruby on Rails 5.0 リリースノート</option>
                  <option value="4_2_release_notes.html">Ruby on Rails 4.2 リリースノート</option>
                  <option value="4_1_release_notes.html">Ruby on Rails 4.1 リリースノート</option>
                  <option value="4_0_release_notes.html">Ruby on Rails 4.0 リリースノート</option>
                  <option value="3_2_release_notes.html">Ruby on Rails 3.2 Release Notes [未着手]</option>
                  <option value="3_1_release_notes.html">Ruby on Rails 3.1 Release Notes [未着手]</option>
                  <option value="3_0_release_notes.html">Ruby on Rails 3.0 Release Notes [未着手]</option>
                  <option value="2_3_release_notes.html">Ruby on Rails 2.3 Release Notes [未着手]</option>
                  <option value="2_2_release_notes.html">Ruby on Rails 2.2 Release Notes [未着手]</option>
              </optgroup>
          </select>
        </li>
      </ul>
      </div>
    </div>
  </div>
  <hr class="hide" />
  <div id="feature">
  <div class="wrapper">
      <h2>レイアウトとレンダリング</h2><p>本ガイドでは、Action ControllerとAction Viewによる基本的なレイアウト機能について解説します。</p><p>このガイドの内容:</p>
<ul>
<li>Railsに組み込まれているさまざまなレンダリング (=レスポンスの出力) 方法の使い方</li>
<li>コンテンツが複数のセクションからなるレイアウト作成法</li>
<li>パーシャルを使用してビューをDRYにする方法</li>
<li>レイアウトをネストする方法 (サブテンプレート)</li>
</ul>

                <div id="subCol">
            <h3 class="chapter"><img src="images/chapters_icon.gif" alt="" />目次</h3>
            <ol class="chapters">
<li><a href="#%E6%A6%82%E8%A6%81-%E9%83%A8%E5%93%81%E3%82%92%E7%B5%84%E3%81%BF%E4%B8%8A%E3%81%92%E3%82%8B">概要: 部品を組み上げる</a></li>
<li>
<a href="#%E3%83%AC%E3%82%B9%E3%83%9D%E3%83%B3%E3%82%B9%E3%82%92%E4%BD%9C%E6%88%90%E3%81%99%E3%82%8B">レスポンスを作成する</a>

<ul>
<li><a href="#%E3%83%87%E3%83%95%E3%82%A9%E3%83%AB%E3%83%88%E3%81%AE%E5%87%BA%E5%8A%9B-%E3%82%A2%E3%82%AF%E3%82%B7%E3%83%A7%E3%83%B3%E3%81%AB%E3%81%8A%E3%81%91%E3%82%8B%E3%80%8C%E8%A8%AD%E5%AE%9A%E3%82%88%E3%82%8A%E8%A6%8F%E7%B4%84%E3%80%8D">デフォルトの出力: アクションにおける「設定より規約」</a></li>
<li><a href="#render%E3%82%92%E4%BD%BF%E7%94%A8%E3%81%99%E3%82%8B"><code>render</code>を使用する</a></li>
<li><a href="#redirect-to%E3%82%92%E4%BD%BF%E7%94%A8%E3%81%99%E3%82%8B"><code>redirect_to</code>を使用する</a></li>
<li><a href="#head%E3%81%A7%E3%83%98%E3%83%83%E3%83%80%E3%81%AE%E3%81%BF%E3%81%AE%E3%83%AC%E3%82%B9%E3%83%9D%E3%83%B3%E3%82%B9%E3%82%92%E7%94%9F%E6%88%90%E3%81%99%E3%82%8B"><code>head</code>でヘッダのみのレスポンスを生成する</a></li>
</ul>
</li>
<li>
<a href="#%E3%83%AC%E3%82%A4%E3%82%A2%E3%82%A6%E3%83%88%E3%82%92%E6%A7%8B%E6%88%90%E3%81%99%E3%82%8B">レイアウトを構成する</a>

<ul>
<li><a href="#%E3%82%A2%E3%82%BB%E3%83%83%E3%83%88%E3%82%BF%E3%82%B0%E3%83%98%E3%83%AB%E3%83%91%E3%83%BC">アセットタグヘルパー</a></li>
<li><a href="#yield%E3%82%92%E7%90%86%E8%A7%A3%E3%81%99%E3%82%8B"><code>yield</code>を理解する</a></li>
<li><a href="#content-for%E3%82%92%E4%BD%BF%E7%94%A8%E3%81%99%E3%82%8B"><code>content_for</code>を使用する</a></li>
<li><a href="#%E3%83%91%E3%83%BC%E3%82%B7%E3%83%A3%E3%83%AB%E3%82%92%E4%BD%BF%E7%94%A8%E3%81%99%E3%82%8B">パーシャルを使用する</a></li>
<li><a href="#%E3%83%8D%E3%82%B9%E3%83%88%E3%81%97%E3%81%9F%E3%83%AC%E3%82%A4%E3%82%A2%E3%82%A6%E3%83%88%E3%82%92%E4%BD%BF%E7%94%A8%E3%81%99%E3%82%8B">ネストしたレイアウトを使用する</a></li>
</ul>
</li>
</ol>

          </div>
</div>
  </div>

  <div id="container">
    <div class="wrapper">
      <div id="mainCol">
        <h3 id="概要-部品を組み上げる"><a href="#%E6%A6%82%E8%A6%81-%E9%83%A8%E5%93%81%E3%82%92%E7%B5%84%E3%81%BF%E4%B8%8A%E3%81%92%E3%82%8B">1 概要: 部品を組み上げる</a></h3><p>本ガイドでは、コントローラ、ビュー、モデルによって形成される三角形のうち、コントローラとビューの間でのやりとりを中心に扱います。ご存じのように、Railsのコントローラはリクエストを扱うプロセス全体の流れを組織的に調整する責任を負い、(ビジネスロジックのような) 重い処理はモデルの方で行なうのが普通です。モデル側での処理が完了し、ユーザーに結果を表示する時がきたら、コントローラは処理結果をビューに渡します。このときの、コントローラからビューへの結果の渡し方こそが本ガイドの主なトピックです。</p><p>大きな流れとしては、ユーザーへのレスポンスとして送信すべき内容を決定することと、ユーザーへのレスポンスを作成するために適切なメソッドを呼び出すこともこの作業に含まれます。ユーザーに返すレスポンス画面を完全なビューにするのであれば、Railsはそのビューをさらに別のレイアウトでラッピングし、パーシャルビューとして取り出すでしょう。以後本ガイドではこれらの方法をすべて紹介します(訳注: 本ガイドではrenderを一般的な意味では「出力」、具体的な動作を指す場合は「レンダリング」と訳しています)。</p><h3 id="レスポンスを作成する"><a href="#%E3%83%AC%E3%82%B9%E3%83%9D%E3%83%B3%E3%82%B9%E3%82%92%E4%BD%9C%E6%88%90%E3%81%99%E3%82%8B">2 レスポンスを作成する</a></h3><p>コントローラ側から見ると、HTTPレスポンスの作成方法は以下の3とおりあります。</p>
<ul>
<li>
<code>render</code>を呼び出し、ブラウザに返す完全なレスポンスを作成する</li>
<li>
<code>redirect_to</code>を呼び出し、HTTPリダイレクトコードステータスをブラウザに送信する</li>
<li>
<code>head</code>を呼び出し、HTTPヘッダーのみで構成されたレスポンスを作成してブラウザに送信する</li>
</ul>
<h4 id="デフォルトの出力-アクションにおける「設定より規約」"><a href="#%E3%83%87%E3%83%95%E3%82%A9%E3%83%AB%E3%83%88%E3%81%AE%E5%87%BA%E5%8A%9B-%E3%82%A2%E3%82%AF%E3%82%B7%E3%83%A7%E3%83%B3%E3%81%AB%E3%81%8A%E3%81%91%E3%82%8B%E3%80%8C%E8%A8%AD%E5%AE%9A%E3%82%88%E3%82%8A%E8%A6%8F%E7%B4%84%E3%80%8D">2.1 デフォルトの出力: アクションにおける「設定より規約」</a></h4><p>Railsでは「設定より規約 (CoC: convention over configuration)」というポリシーが推奨されていることをご存じかと思います。デフォルトの出力結果は、CoCのよい例でもあります。Railsのコントローラは、デフォルトでは正しいルーティングに対応する名前を持つビューを自動的に選び、それを使用してレスポンスを出力します。たとえば、<code>BooksController</code>というコントローラに以下のコードがあるとします。</p><div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
class BooksController &lt; ApplicationController
end

</pre>
</div>
<p>ルーティングファイルに以下が記載されているとします。</p><div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
  resources :books

</pre>
</div>
<p><code>app/views/books/index.html.erb</code>ビューファイルの内容が以下のようになっているとします。</p><div class="code_container">
<pre class="brush: plain; gutter: false; toolbar: false">
&lt;h1&gt;Books are coming soon!&lt;/h1&gt;

</pre>
</div>
<p>以上のようにすることで、ユーザーがブラウザで<code>/books</code>にアクセスすると、Railsは自動的に<code>app/views/books/index.html.erb</code>ビューを使用してレスポンスを出力し、その結果「Books are coming soon!」という文字が画面に表示されます。</p><p>しかしこの画面だけではほとんど実用性がないので、<code>Book</code>モデルを作成し、<code>BooksController</code>にindexアクションを追加してみましょう。</p><div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
class BooksController &lt; ApplicationController
  def index
    @books = Book.all
  end
end

</pre>
</div>
<p>上のコードでご注目いただきたいのは、「設定より規約」の原則が利いているおかげでindexアクションの最後で明示的に画面出力を指示する必要がないという点です。ここでの原則は、「コントローラのアクションの最終部分で明示的な画面出力が指示されていない場合は、コントローラが使用できるビューのパスから<code>アクション名.html.erb</code>というビューテンプレートを探し、それを使用して自動的に出力する」というものです。従って、この場合は<code>app/views/books/index.html.erb</code>ファイルが出力されます。</p><p>ビューですべての本の属性を表示したい場合は、以下のようにERBを書くことができます。</p><div class="code_container">
<pre class="brush: plain; gutter: false; toolbar: false">
&lt;h1&gt;Listing Books&lt;/h1&gt;

&lt;table&gt;
  &lt;tr&gt;
    &lt;th&gt;Title&lt;/th&gt;
    &lt;th&gt;Summary&lt;/th&gt;
    &lt;th&gt;&lt;/th&gt;
    &lt;th&gt;&lt;/th&gt;
    &lt;th&gt;&lt;/th&gt;
  &lt;/tr&gt;

&lt;% @books.each do |book| %&gt;
  &lt;tr&gt;
    &lt;td&gt;&lt;%= book.title %&gt;&lt;/td&gt;
    &lt;td&gt;&lt;%= book.content %&gt;&lt;/td&gt;
    &lt;td&gt;&lt;%= link_to "Show", book %&gt;&lt;/td&gt;
    &lt;td&gt;&lt;%= link_to "Edit", edit_book_path(book) %&gt;&lt;/td&gt;
    &lt;td&gt;&lt;%= link_to "Remove", book, method: :delete, data: { confirm: "Are you sure?" } %&gt;&lt;/td&gt;
  &lt;/tr&gt;
&lt;% end %&gt;
&lt;/table&gt;

&lt;br&gt;

&lt;%= link_to "New book", new_book_path %&gt;

</pre>
</div>
<div class="note"><p>実際のレンダリングは、<code>ActionView::TemplateHandlers</code>のサブクラスで行われます。本ガイドではレンダリングの詳細については触れませんが、テンプレートハンドラの選択がビューテンプレートファイルの拡張子によって制御されているという重要な点は理解しておいてください。Rails 2以降におけるビューテンプレートの標準拡張子は、ERB (HTML + eMbedded RuBy) でレンダリングする場合は<code>.erb</code>、Builder (XMLジェネレータ) でレンダリングする場合は<code>.builder</code>です。</p></div><h4 id="renderを使用する"><a href="#render%E3%82%92%E4%BD%BF%E7%94%A8%E3%81%99%E3%82%8B">2.2 <code>render</code>を使用する</a></h4><p>アプリケーションがブラウザで表示するコンテンツのレンダリング (出力) という力仕事は、<code>ActionController::Base#render</code>メソッドがほぼ一手に引き受けています。<code>render</code>メソッドはさまざまな方法でカスタマイズできます。Railsテンプレートのデフォルトビューを出力することもできますし、特定のテンプレート、ファイル、インラインコードを指定して出力したり、何も出力しないこともできます。テキスト、JSON、XMLを出力することもできます。出力されるレスポンスのcontent typeやHTTPステータスを指定することもできます。</p><div class="info"><p>出力結果をブラウザで表示して調べることなく、<code>render</code>呼び出しの正確な結果を取得したい場合は、<code>render_to_string</code>を呼び出すことができます。このメソッドの動作は<code>render</code>と完全に同じであり、出力結果をブラウザに返さずに文字列を返す点だけが異なります。</p></div><h5 id="何も出力しない方法"><a href="#%E4%BD%95%E3%82%82%E5%87%BA%E5%8A%9B%E3%81%97%E3%81%AA%E3%81%84%E6%96%B9%E6%B3%95">2.2.1 何も出力しない方法</a></h5><p><code>render</code>メソッドでできる最も単純な動作は、何も出力しないことでしょう。</p><div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
render nothing: true

</pre>
</div>
<p>このレスポンスをcurlコマンドを使用して調べてみると以下のようになっています。</p><div class="code_container">
<pre class="brush: plain; gutter: false; toolbar: false">
$ curl -i 127.0.0.1:3000/books
HTTP/1.1 200 OK
Connection: close
Date: Sun, 24 Jan 2010 09:25:18 GMT
Transfer-Encoding: chunked
Content-Type: */*; charset=utf-8
X-Runtime: 0.014297
Set-Cookie: _blog_session=...snip...; path=/; HttpOnly
Cache-Control: no-cache

$

</pre>
</div>
<p>レスポンスの内容は空欄になっています (<code>Cache-Control</code>行以降にデータがない) が、ステータスコートが200 OKになっているのでリクエストが成功していることがわかります。renderメソッドの<code>:status</code>オプションを設定することでレスポンスを変更できます。何も出力しないというレスポンスは、Ajaxリクエストを使用する時に便利です。これを使用することで、リクエストが成功したという確認応答だけをブラウザに送り返すことができるからです。</p><div class="info"><p>200 OKヘッダーだけを送信したいのであれば、ここでご紹介した<code>render :nothing</code>よりも、本ガイドで後述する<code>head</code>メソッドを使用する方がおそらくよいでしょう。<code>head</code>メソッドは<code>render :nothing</code>よりも柔軟性が高く、HTTPヘッダーだけを生成していることが明確になるからです。</p></div><h5 id="action-viewを出力する"><a href="#action-view%E3%82%92%E5%87%BA%E5%8A%9B%E3%81%99%E3%82%8B">2.2.2 Action Viewを出力する</a></h5><p>同じコントローラで、デフォルトと異なるテンプレートに対応するビューを出力したい場合は、<code>render</code>メソッドでビュー名を指定することができます。</p><div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
def update
  @book = Book.find(params[:id])
  if @book.update(book_params)
    redirect_to(@book)
  else
    render "edit"
  end
end

</pre>
</div>
<p>上の<code>update</code>アクションでモデルに対する<code>update</code>メソッドの呼び出しが失敗すると、同じコントローラに用意しておいた別の<code>edit.html.erb</code>テンプレートを使用して出力します。</p><p>出力するアクションを指定するには、文字列の他にシンボルを使用することもできます。</p><div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
def update
  @book = Book.find(params[:id])
  if @book.update(book_params)
    redirect_to(@book)
  else
    render :edit
  end
end

</pre>
</div>
<h5 id="別のコントローラからアクションのテンプレートを出力する"><a href="#%E5%88%A5%E3%81%AE%E3%82%B3%E3%83%B3%E3%83%88%E3%83%AD%E3%83%BC%E3%83%A9%E3%81%8B%E3%82%89%E3%82%A2%E3%82%AF%E3%82%B7%E3%83%A7%E3%83%B3%E3%81%AE%E3%83%86%E3%83%B3%E3%83%97%E3%83%AC%E3%83%BC%E3%83%88%E3%82%92%E5%87%BA%E5%8A%9B%E3%81%99%E3%82%8B">2.2.3 別のコントローラからアクションのテンプレートを出力する</a></h5><p>あるコントローラのアクションから、まったく別のコントローラの配下にあるテンプレートを使用して出力することは可能でしょうか。これも<code>render</code>メソッドだけで行なうことができます。<code>render</code>メソッドには<code>app/views</code>を起点とするフルパスを渡すことができますので、出力したいテンプレートをフルパスで指定します。たとえば、<code>app/controllers/admin</code>に置かれている<code>AdminProducts</code>コントローラのコードを実行しているとすると、<code>app/views/products</code>に置かれているビューテンプレートに対するアクションの実行結果を出力するには以下のようにします。</p><div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
render "products/show"

</pre>
</div>
<p>パスにスラッシュ<code>/</code>が含まれていると、Railsによってこのビューは異なるコントローラの配下にあると認識されます。異なるコントローラのテンプレートを指定していることをより明示的にしたい場合は、以下のように<code>:template</code>オプションを使用することもできます (Rails 2.2以前ではこのオプションは必須でした)。</p><div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
render template: "products/show"

</pre>
</div>
<h5 id="任意のファイルを使用して出力する"><a href="#%E4%BB%BB%E6%84%8F%E3%81%AE%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB%E3%82%92%E4%BD%BF%E7%94%A8%E3%81%97%E3%81%A6%E5%87%BA%E5%8A%9B%E3%81%99%E3%82%8B">2.2.4 任意のファイルを使用して出力する</a></h5><p><code>render</code>メソッドで指定するビューは、現在のアプリケーションディレクトリの外部にあっても構いません (2つのRailsアプリケーションでビューを共有しているなどの場合)。</p><div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
render "/u/apps/warehouse_app/current/app/views/products/show"

</pre>
</div>
<p>パスがスラッシュ<code>/</code>で始まっている場合、Railsはこのコードがファイルの出力であると認識します。ファイルを出力することをより明示的にしたい場合は、以下のように<code>:file</code>オプションを使用することもできます (Rails 2.2以前ではこのオプションは必須でした)。</p><div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
render file: "/u/apps/warehouse_app/current/app/views/products/show"

</pre>
</div>
<p><code>:file</code>オプションに与えるパスは、ファイルシステムの絶対パスです。当然ながら、コンテンツを出力したいファイルに対して適切なアクセス権が与えられている必要があります。</p><div class="note"><p>ファイルを出力する場合、デフォルトでは現在のレイアウトが適用されません。ファイルの出力を現在のレイアウト内で行いたい場合は、<code>layout: true</code>オプションを追加する必要があります。</p></div><div class="info"><p>Microsoft Windows上でRailsを実行している場合、ファイルを出力する際に<code>:file</code>オプションを省略できません。Windowsのファイル名フォーマットはUnixのファイル名と同じではないためです。</p></div><h5 id="まとめ"><a href="#%E3%81%BE%E3%81%A8%E3%82%81">2.2.5 まとめ</a></h5><p>これまでご紹介した3通りの出力方法 (コントローラ内の別テンプレートを使用、別のコントローラのテンプレートを使用、ファイルシステム上の任意のファイルを使用) は、実際には同一のアクションのバリエーションにすぎません。</p><p>実のところ、たとえばBooksControllerクラスのupdateアクション内で、本の更新に失敗したらeditテンプレートを出力したいとすると、以下のどのレンダリング呼び出しを行っても最終的には必ず<code>views/books</code>ディレクトリの<code>edit.html.erb</code>を使用して出力が行われます。</p><div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
render :edit
render action: :edit
render "edit"
render "edit.html.erb"
render action: "edit"
render action: "edit.html.erb"
render "books/edit"
render "books/edit.html.erb"
render template: "books/edit"
render template: "books/edit.html.erb"
render "/path/to/rails/app/views/books/edit"
render "/path/to/rails/app/views/books/edit.html.erb"
render file: "/path/to/rails/app/views/books/edit"
render file: "/path/to/rails/app/views/books/edit.html.erb"

</pre>
</div>
<p>どの呼び出しを使用するかはコーディングのスタイルと規則の問題でしかありませんが、経験上なるべくシンプルな記法を使用する方がコードがわかりやすくなるでしょう。</p><h5 id="renderで-inlineオプションを使用する"><a href="#render%E3%81%A7-inline%E3%82%AA%E3%83%97%E3%82%B7%E3%83%A7%E3%83%B3%E3%82%92%E4%BD%BF%E7%94%A8%E3%81%99%E3%82%8B">2.2.6 <code>render</code>で<code>:inline</code>オプションを使用する</a></h5><p><code>render</code>メソッドは、メソッド呼び出しの際に<code>:inline</code>オプションを使用してERBを与えると、ビューがまったくない状態でも実行することができます。これは完全に有効な方法です。</p><div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
render inline: "&lt;% products.each do |p| %&gt;&lt;p&gt;&lt;%= p.name %&gt;&lt;/p&gt;&lt;% end %&gt;"

</pre>
</div>
<div class="warning"><p>このオプションを実際に使用する意味はほぼないと思われます。コントローラのコードにERBを混在させると、RailsのMVC指向が崩されるだけでなく、開発者がプロジェクトのロジックを追いかけることが困難になってしまいます。通常のERBビューを使用してください。</p></div><p>インラインでは、デフォルトでERBを使用して出力を行います。<code>:type</code>オプションで:builderを指定すると、ERBに代えてBuilderが使用されます。</p><div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
render inline: "xml.p {'Horrid coding practice!'}", type: :builder

</pre>
</div>
<h5 id="テキストを出力する"><a href="#%E3%83%86%E3%82%AD%E3%82%B9%E3%83%88%E3%82%92%E5%87%BA%E5%8A%9B%E3%81%99%E3%82%8B">2.2.7 テキストを出力する</a></h5><p><code>render</code>で<code>:plain</code>オプションを使用すると、平文テキストをマークアップせずにブラウザに送信することができます。</p><div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
render plain: "OK"

</pre>
</div>
<div class="info"><p>平文テキストの出力は、AjaxやWebサービスリクエストに応答するときに最も有用です。これらではHTML以外の応答を期待しています。</p></div><div class="note"><p>デフォルトでは、<code>:plain</code>オプションを使用すると出力結果に現在のレイアウトが適用されません。テキストの出力を現在のレイアウト内で行いたい場合は、<code>layout: true</code>オプションを追加する必要があります。</p></div><h5 id="htmlを出力する"><a href="#html%E3%82%92%E5%87%BA%E5%8A%9B%E3%81%99%E3%82%8B">2.2.8 HTMLを出力する</a></h5><p><code>render</code>で<code>:html</code>オプションを使用すると、HTML文字列を直接ブラウザに送信することができます。</p><div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
render html: "&lt;strong&gt;Not Found&lt;/strong&gt;".html_safe

</pre>
</div>
<div class="info"><p>この手法は、HTMLコードのごく小規模なスニペットを出力したい場合に便利です。
スニペットのマークアップが複雑になるようであれば、早めにテンプレートファイルに移行することをご検討ください。</p></div><div class="note"><p>このオプションを使用すると、文字列が「HTML safe」でない場合にHTML要素をエスケープします。</p></div><h5 id="jsonを出力する"><a href="#json%E3%82%92%E5%87%BA%E5%8A%9B%E3%81%99%E3%82%8B">2.2.9 JSONを出力する</a></h5><p>JSONはJavaScriptのデータ形式の一種で、多くのAjaxライブラリで使用されています。Railsでは、オブジェクトからJSON形式への変換と、変換されたJSONをブラウザに送信する機能がビルトインでサポートされています。</p><div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
render json: @product

</pre>
</div>
<div class="info"><p>出力するオブジェクトに対して<code>to_json</code>を呼び出す必要はありません。<code>:json</code>オプションが指定されていれば、<code>render</code>によって<code>to_json</code>が自動的に呼び出されるようになっています。</p></div><h5 id="xmlを出力する"><a href="#xml%E3%82%92%E5%87%BA%E5%8A%9B%E3%81%99%E3%82%8B">2.2.10 XMLを出力する</a></h5><p>Railsでは、オブジェクトからXML形式への変換と、変換されたXMLをブラウザに送信する機能がビルトインでサポートされています。</p><div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
render xml: @product

</pre>
</div>
<div class="info"><p>出力するオブジェクトに対して<code>to_xml</code>を呼び出す必要はありません。<code>:xml</code>オプションが指定されていれば、<code>render</code>によって<code>to_xml</code>が自動的に呼び出されるようになっています。</p></div><h5 id="vanilla-javascriptを出力する"><a href="#vanilla-javascript%E3%82%92%E5%87%BA%E5%8A%9B%E3%81%99%E3%82%8B">2.2.11 Vanilla JavaScriptを出力する</a></h5><p>Railsはvanilla JavaScriptを出力することもできます。</p><div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
render js: "alert('Hello Rails');"

</pre>
</div>
<p>上のコードは、引数で与えられた文字列をMIMEタイプ<code>text/javascript</code>でブラウザに送信します。</p><h5 id="生のコンテンツを出力する"><a href="#%E7%94%9F%E3%81%AE%E3%82%B3%E3%83%B3%E3%83%86%E3%83%B3%E3%83%84%E3%82%92%E5%87%BA%E5%8A%9B%E3%81%99%E3%82%8B">2.2.12 生のコンテンツを出力する</a></h5><p><code>render</code>で<code>:body</code>オプションを指定することで、content typeを一切指定しない生のコンテンツをブラウザに送信することができます。</p><div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
render body: "raw"

</pre>
</div>
<div class="info"><p>このオプションを使用するのは、レスポンスのcontent typeがどんなものであってもよい場合のみにしてください。ほとんどの場合、<code>:plain</code>や<code>:html</code>などを使用する方が適切です。</p></div><div class="note"><p>このオプションを使用してブラウザに送信されるレスポンスは、上書きされない限り<code>text/html</code>が使用されます。これはAction Dispatchによるレスポンスのデフォルトのcontent typeであるためです。</p></div><h5 id="renderのオプション"><a href="#render%E3%81%AE%E3%82%AA%E3%83%97%E3%82%B7%E3%83%A7%E3%83%B3">2.2.13 <code>render</code>のオプション</a></h5><p><code>render</code>メソッドに対する呼び出しでは、一般に以下の4つのオプションが使用できます。</p>
<ul>
<li><code>:content_type</code></li>
<li><code>:layout</code></li>
<li><code>:location</code></li>
<li><code>:status</code></li>
</ul>
<h6 id="content-typeオプション"><a href="#content-type%E3%82%AA%E3%83%97%E3%82%B7%E3%83%A7%E3%83%B3">2.2.13.1 <code>:content_type</code>オプション</a></h6><p>Railsがデフォルトで出力する結果のMIME content-typeは、デフォルトで<code>text/html</code>になります (ただし<code>:json</code>を指定した場合には<code>application/json</code>、<code>:xml</code>を使用した場合は<code>application/xml</code>になります)。content-typeを変更したい場合は、<code>:content_type</code>オプションを指定します。</p><div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
render file: filename, content_type: "application/rss"

</pre>
</div>
<h6 id="layoutオプション"><a href="#layout%E3%82%AA%E3%83%97%E3%82%B7%E3%83%A7%E3%83%B3">2.2.13.2 <code>:layout</code>オプション</a></h6><p><code>render</code>で指定できるほとんどのオプションでは、出力されるコンテンツは現在のレイアウトの一部としてブラウザ上で表示されます。これより、レイアウトの詳細と利用法について本ガイドで説明します。</p><p><code>:layout</code>オプションを指定すると、現在のアクションに対して特定のファイルをレイアウトとして使用します。</p><div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
render layout: "special_layout"

</pre>
</div>
<p>出力時にレイアウトをまったく使用しないよう指定することもできます。</p><div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
render layout: false

</pre>
</div>
<h6 id="locationオプション"><a href="#location%E3%82%AA%E3%83%97%E3%82%B7%E3%83%A7%E3%83%B3">2.2.13.3 <code>:location</code>オプション</a></h6><p><code>:location</code>を使用することで、HTTPの<code>Location</code>ヘッダーを設定できます。</p><div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
render xml: photo, location: photo_url(photo)

</pre>
</div>
<h6 id="statusオプション"><a href="#status%E3%82%AA%E3%83%97%E3%82%B7%E3%83%A7%E3%83%B3">2.2.13.4 <code>:status</code>オプション</a></h6><p>Railsが返すレスポンスのHTTPステータスコードは自動的に生成されます (ほとんどの場合<code>200 OK</code>となります)。<code>:status</code>オプションを使用することで、レスポンスのステータスコードを変更できます。</p><div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
render status: 500
render status: :forbidden

</pre>
</div>
<p>ステータスコードは数字で指定する他に、以下に示すシンボルで指定することもできます。</p>
<table>
<thead>
<tr>
<th>レスポンスクラス</th>
<th>HTTPステータスコード</th>
<th>シンボル</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Informational</strong></td>
<td>100</td>
<td>:continue</td>
</tr>
<tr>
<td></td>
<td>101</td>
<td>:switching_protocols</td>
</tr>
<tr>
<td></td>
<td>102</td>
<td>:processing</td>
</tr>
<tr>
<td><strong>Success</strong></td>
<td>200</td>
<td>:ok</td>
</tr>
<tr>
<td></td>
<td>201</td>
<td>:created</td>
</tr>
<tr>
<td></td>
<td>202</td>
<td>:accepted</td>
</tr>
<tr>
<td></td>
<td>203</td>
<td>:non_authoritative_information</td>
</tr>
<tr>
<td></td>
<td>204</td>
<td>:no_content</td>
</tr>
<tr>
<td></td>
<td>205</td>
<td>:reset_content</td>
</tr>
<tr>
<td></td>
<td>206</td>
<td>:partial_content</td>
</tr>
<tr>
<td></td>
<td>207</td>
<td>:multi_status</td>
</tr>
<tr>
<td></td>
<td>208</td>
<td>:already_reported</td>
</tr>
<tr>
<td></td>
<td>226</td>
<td>:im_used</td>
</tr>
<tr>
<td><strong>Redirection</strong></td>
<td>300</td>
<td>:multiple_choices</td>
</tr>
<tr>
<td></td>
<td>301</td>
<td>:moved_permanently</td>
</tr>
<tr>
<td></td>
<td>302</td>
<td>:found</td>
</tr>
<tr>
<td></td>
<td>303</td>
<td>:see_other</td>
</tr>
<tr>
<td></td>
<td>304</td>
<td>:not_modified</td>
</tr>
<tr>
<td></td>
<td>305</td>
<td>:use_proxy</td>
</tr>
<tr>
<td></td>
<td>306</td>
<td>:reserved</td>
</tr>
<tr>
<td></td>
<td>307</td>
<td>:temporary_redirect</td>
</tr>
<tr>
<td></td>
<td>308</td>
<td>:permanent_redirect</td>
</tr>
<tr>
<td><strong>Client Error</strong></td>
<td>400</td>
<td>:bad_request</td>
</tr>
<tr>
<td></td>
<td>401</td>
<td>:unauthorized</td>
</tr>
<tr>
<td></td>
<td>402</td>
<td>:payment_required</td>
</tr>
<tr>
<td></td>
<td>403</td>
<td>:forbidden</td>
</tr>
<tr>
<td></td>
<td>404</td>
<td>:not_found</td>
</tr>
<tr>
<td></td>
<td>405</td>
<td>:method_not_allowed</td>
</tr>
<tr>
<td></td>
<td>406</td>
<td>:not_acceptable</td>
</tr>
<tr>
<td></td>
<td>407</td>
<td>:proxy_authentication_required</td>
</tr>
<tr>
<td></td>
<td>408</td>
<td>:request_timeout</td>
</tr>
<tr>
<td></td>
<td>409</td>
<td>:conflict</td>
</tr>
<tr>
<td></td>
<td>410</td>
<td>:gone</td>
</tr>
<tr>
<td></td>
<td>411</td>
<td>:length_required</td>
</tr>
<tr>
<td></td>
<td>412</td>
<td>:precondition_failed</td>
</tr>
<tr>
<td></td>
<td>413</td>
<td>:request_entity_too_large</td>
</tr>
<tr>
<td></td>
<td>414</td>
<td>:request_uri_too_long</td>
</tr>
<tr>
<td></td>
<td>415</td>
<td>:unsupported_media_type</td>
</tr>
<tr>
<td></td>
<td>416</td>
<td>:requested_range_not_satisfiable</td>
</tr>
<tr>
<td></td>
<td>417</td>
<td>:expectation_failed</td>
</tr>
<tr>
<td></td>
<td>422</td>
<td>:unprocessable_entity</td>
</tr>
<tr>
<td></td>
<td>423</td>
<td>:locked</td>
</tr>
<tr>
<td></td>
<td>424</td>
<td>:failed_dependency</td>
</tr>
<tr>
<td></td>
<td>426</td>
<td>:upgrade_required</td>
</tr>
<tr>
<td></td>
<td>428</td>
<td>:precondition_required</td>
</tr>
<tr>
<td></td>
<td>429</td>
<td>:too_many_requests</td>
</tr>
<tr>
<td></td>
<td>431</td>
<td>:request_header_fields_too_large</td>
</tr>
<tr>
<td><strong>Server Error</strong></td>
<td>500</td>
<td>:internal_server_error</td>
</tr>
<tr>
<td></td>
<td>501</td>
<td>:not_implemented</td>
</tr>
<tr>
<td></td>
<td>502</td>
<td>:bad_gateway</td>
</tr>
<tr>
<td></td>
<td>503</td>
<td>:service_unavailable</td>
</tr>
<tr>
<td></td>
<td>504</td>
<td>:gateway_timeout</td>
</tr>
<tr>
<td></td>
<td>505</td>
<td>:http_version_not_supported</td>
</tr>
<tr>
<td></td>
<td>506</td>
<td>:variant_also_negotiates</td>
</tr>
<tr>
<td></td>
<td>507</td>
<td>:insufficient_storage</td>
</tr>
<tr>
<td></td>
<td>508</td>
<td>:loop_detected</td>
</tr>
<tr>
<td></td>
<td>510</td>
<td>:not_extended</td>
</tr>
<tr>
<td></td>
<td>511</td>
<td>:network_authentication_required</td>
</tr>
</tbody>
</table>
<h5 id="レイアウトの探索順序"><a href="#%E3%83%AC%E3%82%A4%E3%82%A2%E3%82%A6%E3%83%88%E3%81%AE%E6%8E%A2%E7%B4%A2%E9%A0%86%E5%BA%8F">2.2.14 レイアウトの探索順序</a></h5><p>Railsは現在のレイアウトを探索する場合、最初に現在のコントローラと同じ基本名を持つレイアウトが<code>app/views/layouts</code>ディレクトリにあるかどうかを調べます。たとえば、<code>PhotosController</code>クラスのアクションから出力するのであれば、<code>app/views/layouts/photos.html.erb</code>または<code>app/views/layouts/photos.builder</code>を探します。該当のコントローラに属するレイアウトがない場合、<code>app/views/layouts/application.html.erb</code>または<code>app/views/layouts/application.builder</code>を使用します。<code>.erb</code>レイアウトがない場合、<code>.builder</code>レイアウトがあればそれを使用します。Railsには、各コントローラやアクションに割り当てる特定のレイアウトをもっと正確に指定する方法がいくつも用意されています。</p><h6 id="コントローラ用のレイアウトを指定する"><a href="#%E3%82%B3%E3%83%B3%E3%83%88%E3%83%AD%E3%83%BC%E3%83%A9%E7%94%A8%E3%81%AE%E3%83%AC%E3%82%A4%E3%82%A2%E3%82%A6%E3%83%88%E3%82%92%E6%8C%87%E5%AE%9A%E3%81%99%E3%82%8B">2.2.14.1 コントローラ用のレイアウトを指定する</a></h6><p><code>layout</code>宣言を使用することで、デフォルトのレイアウト名ルールを上書きすることができます。例: </p><div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
class ProductsController &lt; ApplicationController
  layout "inventory"
  #...
end

</pre>
</div>
<p>この宣言によって、<code>ProductsController</code>からの出力で使用されるレイアウトは<code>app/views/layouts/inventory.html.erb</code>になります。</p><p>アプリケーション全体で特定のレイアウトを使用したい場合は、<code>ApplicationController</code>クラスで<code>layout</code>を宣言します。</p><div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
class ApplicationController &lt; ActionController::Base
  layout "main"
  #...
end

</pre>
</div>
<p>この宣言によって、アプリケーションのすべてのビューで使用されるレイアウトは<code>app/views/layouts/main.html.erb</code>になります。</p><h6 id="実行時にレイアウトを指定する"><a href="#%E5%AE%9F%E8%A1%8C%E6%99%82%E3%81%AB%E3%83%AC%E3%82%A4%E3%82%A2%E3%82%A6%E3%83%88%E3%82%92%E6%8C%87%E5%AE%9A%E3%81%99%E3%82%8B">2.2.14.2 実行時にレイアウトを指定する</a></h6><p>レイアウトの指定にシンボルを使用することで、リクエストが実際に処理されるときまでレイアウトを確定せず、選択を遅延することができます。</p><div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
class ProductsController &lt; ApplicationController
  layout :products_layout

  def show
    @product = Product.find(params[:id])
  end

  private
    def products_layout
      @current_user.special? ? "special" : "products"
    end

end

</pre>
</div>
<p>上のコードは、現在のユーザーが特別なユーザーの場合、そのユーザーが製品ページを見るときに特別なレイアウトを適用します。</p><p>レイアウトを決定する際に、Procなどのインラインメソッドを使用することもできます。たとえばProcオブジェクトを渡すと、Procを渡されたブロックには<code>controller</code>インスタンスが渡されます。これにより、現在のリクエストを元にしてレイアウトを決定することができます。</p><div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
class ProductsController &lt; ApplicationController
  layout Proc.new { |controller| controller.request.xhr? ? "popup" : "application" }
end

</pre>
</div>
<h6 id="条件付きレイアウト"><a href="#%E6%9D%A1%E4%BB%B6%E4%BB%98%E3%81%8D%E3%83%AC%E3%82%A4%E3%82%A2%E3%82%A6%E3%83%88">2.2.14.3 条件付きレイアウト</a></h6><p>コントローラレベルで指定されたレイアウトでは、<code>:only</code>オプションと<code>:except</code>オプションがサポートされています。これらのオプションは、単一のメソッド名またはメソッド名の配列を引数として受け取ります。渡すメソッド名はコントローラ内のメソッド名に対応します。</p><div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
class ProductsController &lt; ApplicationController
  layout "product", except: [:index, :rss]
end

</pre>
</div>
<p>上の宣言によって、<code>rss</code>メソッドと<code>index</code>メソッド以外のすべてのメソッドに<code>product</code>レイアウトが適用されます。</p><h6 id="レイアウトの継承"><a href="#%E3%83%AC%E3%82%A4%E3%82%A2%E3%82%A6%E3%83%88%E3%81%AE%E7%B6%99%E6%89%BF">2.2.14.4 レイアウトの継承</a></h6><p>レイアウト宣言は下の階層に継承されます。下の階層、つまりより具体的なレイアウト宣言は、上の階層、つまりより一般的なレイアウトよりも常に優先されます。例: </p>
<ul>
<li>
<p><code>application_controller.rb</code></p>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
class ApplicationController &lt; ActionController::Base
  layout "main"
end

</pre>
</div>
</li>
<li>
<p><code>posts_controller.rb</code></p>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
class PostsController &lt; ApplicationController
end

</pre>
</div>
</li>
<li>
<p><code>special_posts_controller.rb</code></p>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
class SpecialPostsController &lt; PostsController
  layout "special"
end

</pre>
</div>
</li>
<li>
<p><code>old_posts_controller.rb</code></p>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
class OldPostsController &lt; SpecialPostsController
  layout false

  def show
    @post = Post.find(params[:id])
  end

  def index
    @old_posts = Post.older
    render layout: "old"
  end
  # ...
end

</pre>
</div>
</li>
</ul>
<p>上のアプリケーションは以下のように動作します。</p>
<ul>
<li>ビューの出力には基本的に<code>main</code>レイアウトが使用されます。</li>
<li>
<code>PostsController#index</code>では<code>main</code>レイアウトが使用されます。</li>
<li>
<code>SpecialPostsController#index</code>では<code>special</code>レイアウトが使用されます。</li>
<li>
<code>OldPostsController#show</code>ではレイアウトが適用されません。</li>
<li>
<code>OldPostsController#index</code>では<code>old</code>レイアウトが使用されます。</li>
</ul>
<h5 id="二重レンダリングエラーを避ける"><a href="#%E4%BA%8C%E9%87%8D%E3%83%AC%E3%83%B3%E3%83%80%E3%83%AA%E3%83%B3%E3%82%B0%E3%82%A8%E3%83%A9%E3%83%BC%E3%82%92%E9%81%BF%E3%81%91%E3%82%8B">2.2.15 二重レンダリングエラーを避ける</a></h5><p>Rails開発をやっていれば、一度は "Can only render or redirect once per action" エラーに遭遇したことがあるでしょう。いまいましいエラーですが、修正は比較的簡単です。このエラーはほとんどの場合、開発者が<code>render</code>メソッドの基本的な動作を誤って理解していることが原因です。</p><p>このエラーを発生する以下のコードを例にとって説明しましょう。</p><div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
def show
  @book = Book.find(params[:id])
  if @book.special?
    render action: "special_show"
  end
  render action: "regular_show"
end

</pre>
</div>
<p><code>@book.special?</code>が<code>true</code>の場合、Railsはレンダリングを開始し、<code>@book</code>変数を<code>special_show</code>ビューに転送します。しかし、<code>show</code>アクションのコードはそこで <em>止まらない</em> ことにご注意ください。<code>show</code>アクションのコードは最終行まで実行され、<code>regular_show</code>ビューのレンダリングを行おうとした時点でエラーが発生します。解決法はいたって単純です。1つのコード実行パス内では、<code>render</code>メソッドや<code>redirect</code>メソッドの実行は1度だけにしてください。ここで非常に便利なのが<code>and return</code>というメソッドです。このメソッドを使用して修正したバージョンを以下に示します。</p><div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
def show
  @book = Book.find(params[:id])
  if @book.special?
    render action: "special_show" and return
  end
  render action: "regular_show"
end

</pre>
</div>
<p><code>&amp;&amp; return</code>ではなく<code>and return</code>を使用してください。<code>&amp;&amp; return</code>はRuby言語の&amp;&amp;演算子の優先順位が高すぎてこの文脈では正常に動作しません。</p><p>RailsにビルトインされているActionControllerが行なう暗黙のレンダリングでは、<code>render</code>メソッドが呼び出されたかどうかを確認してからレンダリングを開始します。従って、以下のコードは正常に動作します。</p><div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
def show
  @book = Book.find(params[:id])
  if @book.special?
    render action: "special_show"
  end
end

</pre>
</div>
<p>上のコードは、ある本が<code>special?</code>である場合にのみ<code>special_show</code>テンプレートを使用して出力します。それ以外の場合は<code>show</code>テンプレートを使用して出力します。</p><h4 id="redirect-toを使用する"><a href="#redirect-to%E3%82%92%E4%BD%BF%E7%94%A8%E3%81%99%E3%82%8B">2.3 <code>redirect_to</code>を使用する</a></h4><p>HTTPリクエストにレスポンスを返すもう一つの方法は、<code>redirect_to</code>を使用することです。前述のとおり、<code>render</code>はレスポンス構成時にどのビュー (または他のアセット) を使用するかを指定するためのものです。<code>redirect_to</code>メソッドは、この点において<code>render</code>メソッドと根本的に異なります。<code>redirect_to</code>メソッドは、別のURLに対して改めてリクエストを再送信するよう、ブラウザに指令を出すためのものです。たとえば以下の呼び出しを行なうと、アプリケーションで現在どのページが表示されていても、写真のインデックス表示ページにリダイレクトされます。</p><div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
redirect_to photos_url

</pre>
</div>
<p><code>redirect_to</code>の引数にはどんな値も指定できますが、<code>link_to</code>や<code>url_for</code>を使用するのが普通です。ユーザーを直前のページに戻す、特殊なリダイレクトも行えます。</p><div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
redirect_to :back

</pre>
</div>
<h5 id="リダイレクトのステータスコードを変更する"><a href="#%E3%83%AA%E3%83%80%E3%82%A4%E3%83%AC%E3%82%AF%E3%83%88%E3%81%AE%E3%82%B9%E3%83%86%E3%83%BC%E3%82%BF%E3%82%B9%E3%82%B3%E3%83%BC%E3%83%89%E3%82%92%E5%A4%89%E6%9B%B4%E3%81%99%E3%82%8B">2.3.1 リダイレクトのステータスコードを変更する</a></h5><p><code>redirect_to</code>を呼び出すと、一時的なリダイレクトを意味するHTTPステータスコード302がブラウザに返され、ブラウザはそれに基いてリダイレクトを行います。別のステータスコード (301: 恒久的なリダイレクトがよく使われます) に変更するには<code>:status</code>オプションを使用します。</p><div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
redirect_to photos_path, status: 301

</pre>
</div>
<p><code>render</code>の<code>:status</code>オプションの場合と同様、<code>redirect_to</code>の<code>:status</code>もヘッダーを指定する時に数値の他にシンボルも使用できます。</p><h5 id="renderとredirect-toの違い"><a href="#render%E3%81%A8redirect-to%E3%81%AE%E9%81%95%E3%81%84">2.3.2 <code>render</code>と<code>redirect_to</code>の違い</a></h5><p>ときおり、<code>redirect_to</code>を一種の<code>goto</code>コマンドとして理解している開発初心者を見かけます。Railsコードの実行位置をある場所から別の場所に移動するコマンドであると考えているわけです。これは <em>正しくありません</em> 。<code>redirect_to</code>を実行した後、コードはそこで実行を終了し、ブラウザからの次のリクエストを待ちます (通常のスタンバイ状態)。その直後、<code>redirect_to</code>でブラウザに送信したHTTPステータスコード302に従って、ブラウザから別のURLへのリクエストがサーバーに送信され、サーバーはそのリクエストを改めて処理します。それ以外のことは行っていません。</p><p><code>render</code>と<code>redirect_to</code>の違いを以下のアクションで比較してみましょう。</p><div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
def index
  @books = Book.all
end

def show
  @book = Book.find_by(id: params[:id])
  if @book.nil?
    render action: "index"
  end
end

</pre>
</div>
<p>上のフォームのコードでは、<code>@book</code>インスタンス変数が<code>nil</code>の場合に問題が生じる可能性があります。<code>render :action</code>は、対象となるアクションのコードを実行しないことを覚えておいてください。このため、<code>index</code>ビューでおそらく必要となる<code>@books</code>インスタンス変数には何も設定されず、空の蔵書リストが表示されてしまいます。これを修正する方法のひとつは、renderをredirectに変更することです。</p><div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
def index
  @books = Book.all
end

def show
  @book = Book.find_by(id: params[:id])
  if @book.nil?
    redirect_to action: :index
  end
end

</pre>
</div>
<p>上のコードであれば、ブラウザから改めてindexページにリクエストが送信されるので、<code>index</code>メソッドのコードが正常に実行されます。</p><p>上のコードで1つ残念な点があるとすれば、ブラウザとのやりとりが1往復増えることです。ブラウザから<code>/books/1</code>に対してshowアクションが呼び出され、コントローラが本が1冊もないことを検出すると、コントローラはブラウザに対してステータスコード302 (リダイレクト) レスポンスを返し、<code>/books/</code>に再度アクセスするようブラウザに指令を出します。ブラウザはこの指令に応じ、このコントローラの<code>index</code>アクションを呼び出すためのリクエストを改めてサーバーに送信します。そしてコントローラはこのリクエストを受けてデータベースからすべての蔵書リストを取り出し、indexテンプレートをレンダリングして出力結果をブラウザに送り返すと、ブラウザで蔵書リストが表示されます。</p><p>このやりとりの増加による遅延は、小規模なアプリケーションであればおそらく問題になりませんが、遅延が甚だしくなってきた場合にはこの点を改める必要があるかもしれません。ブラウザとのやりとりを増やさないように工夫した例を以下に示します。</p><div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
def index
  @books = Book.all
end

def show
  @book = Book.find_by(id: params[:id])
  if @book.nil?
    @books = Book.all
    flash.now[:alert] = "Your book was not found"
    render "index"
  end
end

</pre>
</div>
<p>上のコードの動作は次のとおりです。指定されたidを持つ本が見つからない場合は、モデル内のすべての蔵書リストを<code>@books</code>インスタンス変数に保存します。続いてflashによる警告メッセージを追加し、さらに<code>index.html.erb</code>テンプレートを直接レンダリングしてから出力結果をブラウザに送り返します。</p><h4 id="headでヘッダのみのレスポンスを生成する"><a href="#head%E3%81%A7%E3%83%98%E3%83%83%E3%83%80%E3%81%AE%E3%81%BF%E3%81%AE%E3%83%AC%E3%82%B9%E3%83%9D%E3%83%B3%E3%82%B9%E3%82%92%E7%94%9F%E6%88%90%E3%81%99%E3%82%8B">2.4 <code>head</code>でヘッダのみのレスポンスを生成する</a></h4><p><code>head</code>メソッドを使用することで、ヘッダだけで本文 (body) のないレスポンスをブラウザに送信できます。このメソッド名は<code>render :nothing</code>よりも動作を明確に表しています。<code>head</code>メソッドには、HTTPステータスコードを示す多くのシンボルを引数として指定できます (<a href="#status%E3%82%AA%E3%83%97%E3%82%B7%E3%83%A7%E3%83%B3">参照テーブル</a> 参照)。オプションの引数はヘッダ名と値をペアにしたハッシュ値として解釈されます。たとえば、以下のコードはエラーヘッダーのみのレスポンスを返すことができます。</p><div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
head :bad_request

</pre>
</div>
<p>上のコードによって以下のヘッダーが生成されます。</p><div class="code_container">
<pre class="brush: plain; gutter: false; toolbar: false">
HTTP/1.1 400 Bad Request
Connection: close
Date: Sun, 24 Jan 2010 12:15:53 GMT
Transfer-Encoding: chunked
Content-Type: text/html; charset=utf-8
X-Runtime: 0.013483
Set-Cookie: _blog_session=...snip...; path=/; HttpOnly
Cache-Control: no-cache

</pre>
</div>
<p>以下のように、ヘッダーに別の情報を含めることもできます。</p><div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
head :created, location: photo_path(@photo)

</pre>
</div>
<p>上のコードの結果は以下のようになります。</p><div class="code_container">
<pre class="brush: plain; gutter: false; toolbar: false">
HTTP/1.1 201 Created
Connection: close
Date: Sun, 24 Jan 2010 12:16:44 GMT
Transfer-Encoding: chunked
Location: /photos/1
Content-Type: text/html; charset=utf-8
X-Runtime: 0.083496
Set-Cookie: _blog_session=...snip...; path=/; HttpOnly
Cache-Control: no-cache

</pre>
</div>
<h3 id="レイアウトを構成する"><a href="#%E3%83%AC%E3%82%A4%E3%82%A2%E3%82%A6%E3%83%88%E3%82%92%E6%A7%8B%E6%88%90%E3%81%99%E3%82%8B">3 レイアウトを構成する</a></h3><p>Railsがビューからレスポンスを出力するときには、そのビューには現在のレイアウトも組み込まれます。現在のレイアウトを探索するときのルールは、本ガイドで既に説明したものが使用されます。レイアウト内では、さまざまな出力の断片を組み合わせて最終的なレスポンス出力を得るための3つのツールを利用できます。</p>
<ul>
<li>Asset tags</li>
<li>
<code>yield</code> and <code>content_for</code>
</li>
<li>Partials</li>
</ul>
<h4 id="アセットタグヘルパー"><a href="#%E3%82%A2%E3%82%BB%E3%83%83%E3%83%88%E3%82%BF%E3%82%B0%E3%83%98%E3%83%AB%E3%83%91%E3%83%BC">3.1 アセットタグヘルパー</a></h4><p>アセットタグヘルパーが提供するメソッドは、フィード、JavaScript、スタイルシート、画像、動画および音声のビューにリンクするHTMLを生成するためのものです。Railsでは以下の6つのアセットタグヘルパーが利用できます。</p>
<ul>
<li><code>auto_discovery_link_tag</code></li>
<li><code>javascript_include_tag</code></li>
<li><code>stylesheet_link_tag</code></li>
<li><code>image_tag</code></li>
<li><code>video_tag</code></li>
<li><code>audio_tag</code></li>
</ul>
<p>これらのタグは、レイアウトや別のビューで使用することもできます。このうち、<code>auto_discovery_link_tag</code>、<code>javascript_include_tag</code>、<code>stylesheet_link_tag</code>はレイアウトの<code>&lt;head&gt;</code>セクションで使用するのが普通です。</p><div class="warning"><p>これらのアセットタグヘルパーは、指定の場所にアセットがあるかどうかを <em>検証しません</em> 。</p></div><h5 id="auto-discovery-link-tagを使用してフィードにリンクする"><a href="#auto-discovery-link-tag%E3%82%92%E4%BD%BF%E7%94%A8%E3%81%97%E3%81%A6%E3%83%95%E3%82%A3%E3%83%BC%E3%83%89%E3%81%AB%E3%83%AA%E3%83%B3%E3%82%AF%E3%81%99%E3%82%8B">3.1.1 <code>auto_discovery_link_tag</code>を使用してフィードにリンクする</a></h5><p><code>auto_discovery_link_tag</code>ヘルパーを使用すると、多くのブラウザやフィードリーダーでRSSフィードやAtomフィードを検出できるHTMLが生成されます。このメソッドが受け取れる引数は、リンクの種類 (<code>:rss</code>または<code>:atom</code>)、url_forで渡されるオプションのハッシュ、およびタグのハッシュです。</p><div class="code_container">
<pre class="brush: ruby; html-script: true; gutter: false; toolbar: false">
&lt;%= auto_discovery_link_tag(:rss, {action: "feed"},
  {title: "RSS Feed"}) %&gt;

</pre>
</div>
<p><code>auto_discovery_link_tag</code>では以下の3つのタグオプションが使用できます。</p>
<ul>
<li>
<code>:rel</code>はリンク内の<code>rel</code>値を指定します。デフォルト値は "alternate" です。</li>
<li>
<code>:type</code>はMIMEタイプを明示的に指定したい場合に使用します。通常、Railsは適切なMIMEタイプを自動的に生成します。</li>
<li>
<code>:title</code>はリンクのタイトルを指定します。デフォルト値は<code>:type</code>値を大文字にしたものです ("ATOM" や "RSS" など)。</li>
</ul>
<h5 id="javascript-include-tagを使用してjavascriptファイルにリンクする"><a href="#javascript-include-tag%E3%82%92%E4%BD%BF%E7%94%A8%E3%81%97%E3%81%A6javascript%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB%E3%81%AB%E3%83%AA%E3%83%B3%E3%82%AF%E3%81%99%E3%82%8B">3.1.2 <code>javascript_include_tag</code>を使用してJavaScriptファイルにリンクする</a></h5><p><code>javascript_include_tag</code>ヘルパーは、指定されたソースごとにHTML <code>script</code>タグを返します。</p><p>Railsで<a href="asset_pipeline.html">アセットパイプライン</a> を有効にしている場合、JavaScriptへのリンク先は旧Railsの<code>public/javascripts</code>ではなく<code>/assets/javascripts/</code>になります。その後このリンクはアセットパイプラインによって利用可能になります。</p><p>Railsアプリケーション内やRailsエンジン内のJavaScriptファイルは、<code>app/assets</code>、<code>lib/assets</code>、<code>vendor/assets</code>のいずれかの場所に置かれます。これらの置き場所の詳細については、<a href="asset_pipeline.html#%E3%82%A2%E3%82%BB%E3%83%83%E3%83%88%E3%81%AE%E7%B7%A8%E6%88%90">アセットパイプラインガイドの「アセットの編成」</a> を参照してください。</p><p>好みに応じて、ドキュメントルートからの相対フルパスやURLを指定することもできます。たとえば、<code>app/assets</code>、<code>lib/assets</code>、または<code>vendor/assets</code>の下にある<code>javascripts</code>の下にあるJavaScriptファイルにリンクしたい場合は以下のようにします。</p><div class="code_container">
<pre class="brush: ruby; html-script: true; gutter: false; toolbar: false">
&lt;%= javascript_include_tag "main" %&gt;

</pre>
</div>
<p>上のコードにより、以下のような<code>script</code>タグが出力されます。</p><div class="code_container">
<pre class="brush: xml; gutter: false; toolbar: false">
&lt;script src='/assets/main.js'&gt;&lt;/script&gt;

</pre>
</div>
<p>このアセットへのリクエストは、Sprockets gemによって提供されます。</p><p>複数のファイルにアクセスしたい場合 (<code>app/assets/javascripts/main.js</code>と<code>app/assets/javascripts/columns.js</code>など) は以下のようにします。</p><div class="code_container">
<pre class="brush: ruby; html-script: true; gutter: false; toolbar: false">
&lt;%= javascript_include_tag "main", "columns" %&gt;

</pre>
</div>
<p><code>app/assets/javascripts/main.js</code>と<code>app/assets/javascripts/photos/columns.js</code>を含めたい場合は以下のようにします。</p><div class="code_container">
<pre class="brush: ruby; html-script: true; gutter: false; toolbar: false">
&lt;%= javascript_include_tag "main", "/photos/columns" %&gt;

</pre>
</div>
<p><code>http://example.com/main.js</code>を含めるには以下のようにします。</p><div class="code_container">
<pre class="brush: ruby; html-script: true; gutter: false; toolbar: false">
&lt;%= javascript_include_tag "http://example.com/main.js" %&gt;

</pre>
</div>
<h5 id="stylesheet-link-tagを使用してcssファイルにリンクする"><a href="#stylesheet-link-tag%E3%82%92%E4%BD%BF%E7%94%A8%E3%81%97%E3%81%A6css%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB%E3%81%AB%E3%83%AA%E3%83%B3%E3%82%AF%E3%81%99%E3%82%8B">3.1.3 <code>stylesheet_link_tag</code>を使用してCSSファイルにリンクする</a></h5><p><code>stylesheet_link_tag</code>ヘルパーは、提供されたソースごとにHTML <code>&lt;link&gt;</code>タグを返します。</p><p>Railsでアセットパイプラインを有効にしている場合、このヘルパーは<code>/assets/stylesheets/</code>へのリンクを生成します。その後このリンクはSprockets gemによって処理されます。スタイルシートファイルは、<code>app/assets</code>、<code>lib/assets</code>、または<code>vendor/assets</code>のいずれかの場所に置かれます。</p><p>ドキュメントルートからの相対フルパスやURLを指定することもできます。たとえば、<code>app/assets</code>、<code>lib/assets</code>、または<code>vendor/assets</code>の下にある<code>stylesheets</code>の下にあるスタイルシートファイルにリンクしたい場合は以下のようにします。</p><div class="code_container">
<pre class="brush: ruby; html-script: true; gutter: false; toolbar: false">
&lt;%= stylesheet_link_tag "main" %&gt;

</pre>
</div>
<p><code>app/assets/stylesheets/main.css</code>と<code>app/assets/stylesheets/columns.css</code>を含めるには、以下のようにします。</p><div class="code_container">
<pre class="brush: ruby; html-script: true; gutter: false; toolbar: false">
&lt;%= stylesheet_link_tag "main", "columns" %&gt;

</pre>
</div>
<p><code>app/assets/stylesheets/main.css</code>と<code>app/assets/stylesheets/photos/columns.css</code>を含めるには以下のようにします。</p><div class="code_container">
<pre class="brush: ruby; html-script: true; gutter: false; toolbar: false">
&lt;%= stylesheet_link_tag "main", "photos/columns" %&gt;

</pre>
</div>
<p><code>http://example.com/main.css</code>を含めるには以下のようにします。</p><div class="code_container">
<pre class="brush: ruby; html-script: true; gutter: false; toolbar: false">
&lt;%= stylesheet_link_tag "http://example.com/main.css" %&gt;

</pre>
</div>
<p>デフォルトでは、<code>stylesheet_link_tag</code>によって作成されるリンクには<code>media="screen" rel="stylesheet"</code>という属性が含まれます。適切なオプション (<code>:media</code>, <code>:rel</code>) を使用することで、これらのデフォルト値を上書きできます。</p><div class="code_container">
<pre class="brush: ruby; html-script: true; gutter: false; toolbar: false">
&lt;%= stylesheet_link_tag "main_print", media: "print" %&gt;

</pre>
</div>
<h5 id="image-tagを使用して画像にリンクする"><a href="#image-tag%E3%82%92%E4%BD%BF%E7%94%A8%E3%81%97%E3%81%A6%E7%94%BB%E5%83%8F%E3%81%AB%E3%83%AA%E3%83%B3%E3%82%AF%E3%81%99%E3%82%8B">3.1.4 <code>image_tag</code>を使用して画像にリンクする</a></h5><p><code>image_tag</code>は、特定のファイルを指すHTML <code>&lt;img /&gt;</code>タグを生成します。デフォルトでは、ファイルは<code>public/images</code>以下から読み込まれます。</p><div class="warning"><p>画像ファイルの拡張子は省略できません。</p></div><div class="code_container">
<pre class="brush: ruby; html-script: true; gutter: false; toolbar: false">
&lt;%= image_tag "header.png" %&gt;

</pre>
</div>
<p>好みに応じて、画像ファイルへのパスを直接指定することもできます。</p><div class="code_container">
<pre class="brush: ruby; html-script: true; gutter: false; toolbar: false">
&lt;%= image_tag "icons/delete.gif" %&gt;

</pre>
</div>
<p>ハッシュ形式で与えられたHTMLオプションを追加することもできます。</p><div class="code_container">
<pre class="brush: ruby; html-script: true; gutter: false; toolbar: false">
&lt;%= image_tag "icons/delete.gif", {height: 45} %&gt;

</pre>
</div>
<p>ユーザーがブラウザで画像を非表示にしている場合、alt属性のテキストを表示することができます。alt属性が明示的に指定されていない場合は、ファイル名がaltテキストとして使用されます。このときファイル名の先頭は大文字になり、拡張子は取り除かれます。たとえば、以下の2つのimage_tagヘルパーは同じコードを返します。</p><div class="code_container">
<pre class="brush: ruby; html-script: true; gutter: false; toolbar: false">
&lt;%= image_tag "home.gif" %&gt;
&lt;%= image_tag "home.gif", alt: "Home" %&gt;

</pre>
</div>
<p>"{幅}x{高さ}"という形式で特殊なsizeタグを指定することもできます。</p><div class="code_container">
<pre class="brush: ruby; html-script: true; gutter: false; toolbar: false">
&lt;%= image_tag "home.gif", size: "50x20" %&gt;

</pre>
</div>
<p>上の特殊タグ以外にも、<code>:class</code>や<code>:id</code>や<code>:name</code>などの標準的なHTMLオプションを最終的にハッシュにしたものを引数として与えることができます。</p><div class="code_container">
<pre class="brush: ruby; html-script: true; gutter: false; toolbar: false">
&lt;%= image_tag "home.gif", alt: "Go Home",
                          id: "HomeImage",
                          class: "nav_bar" %&gt;

</pre>
</div>
<h5 id="video-tagを使用してビデオにリンクする"><a href="#video-tag%E3%82%92%E4%BD%BF%E7%94%A8%E3%81%97%E3%81%A6%E3%83%93%E3%83%87%E3%82%AA%E3%81%AB%E3%83%AA%E3%83%B3%E3%82%AF%E3%81%99%E3%82%8B">3.1.5 <code>video_tag</code>を使用してビデオにリンクする</a></h5><p><code>video_tag</code>ヘルパーは、指定されたファイルを指すHTML 5 <code>&lt;video&gt;</code>タグを生成します。デフォルトでは、ファイルは<code>public/videos</code>から読み込まれます。</p><div class="code_container">
<pre class="brush: ruby; html-script: true; gutter: false; toolbar: false">
&lt;%= video_tag "movie.ogg" %&gt;

</pre>
</div>
<p>上のコードによって以下が生成されます。</p><div class="code_container">
<pre class="brush: ruby; html-script: true; gutter: false; toolbar: false">
&lt;video src="/videos/movie.ogg" /&gt;

</pre>
</div>
<p><code>image_tag</code>の場合と同様、絶対パスまたは<code>public/videos</code>ディレクトリからの相対パスを指定できます。さらに、<code>image_tag</code>の場合と同様に、<code>size: "#{幅}x#{高さ}"</code>オプションを指定することもできます。ビデオタグでは、<code>id</code>や<code>class</code>などのHTMLオプションを末尾で自由に指定することもできます。</p><p>ビデオタグでは、<code>&lt;video&gt;</code> HTMLオプションを以下のようなHTMLオプションハッシュ形式で指定することもできます。</p>
<ul>
<li>
<code>poster: "image_name.png"</code>は、ビデオ再生前にビデオの位置に表示しておきたい画像を指定します。</li>
<li>
<code>autoplay: true</code>は、ページの読み込み時にビデオを再生します。</li>
<li>
<code>loop: true</code>は、ビデオを最後まで再生し終わったらループします。</li>
<li>
<code>controls: true</code>は、ブラウザが提供するビデオ制御機能を使用できるようにします。</li>
<li>
<code>autobuffer: true</code>は、ページ読み込み時にすぐ再生できるようにビデオを事前に読み込んでおきます。</li>
</ul>
<p><code>video_tag</code>にビデオファイルの配列を渡すことで、複数のビデオを再生することもできます。</p><div class="code_container">
<pre class="brush: ruby; html-script: true; gutter: false; toolbar: false">
&lt;%= video_tag ["trailer.ogg", "movie.ogg"] %&gt;

</pre>
</div>
<p>上のコードによって以下が生成されます。</p><div class="code_container">
<pre class="brush: ruby; html-script: true; gutter: false; toolbar: false">
&lt;video&gt;&lt;source src="trailer.ogg" /&gt;&lt;source src="movie.ogg" /&gt;&lt;/video&gt;

</pre>
</div>
<h5 id="audio-tagを使用して音声ファイルにリンクする"><a href="#audio-tag%E3%82%92%E4%BD%BF%E7%94%A8%E3%81%97%E3%81%A6%E9%9F%B3%E5%A3%B0%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB%E3%81%AB%E3%83%AA%E3%83%B3%E3%82%AF%E3%81%99%E3%82%8B">3.1.6 <code>audio_tag</code>を使用して音声ファイルにリンクする</a></h5><p><code>audio_tag</code>は、指定されたファイルを指すHTML 5 <code>&lt;audio&gt;</code>タグを生成します。デフォルトでは、これらのファイルは<code>public/audios</code>以下から読み込まれます。</p><div class="code_container">
<pre class="brush: ruby; html-script: true; gutter: false; toolbar: false">
&lt;%= audio_tag "music.mp3" %&gt;

</pre>
</div>
<p>好みに応じて、音声ファイルへのパスを直接指定することもできます。</p><div class="code_container">
<pre class="brush: ruby; html-script: true; gutter: false; toolbar: false">
&lt;%= audio_tag "music/first_song.mp3" %&gt;

</pre>
</div>
<p><code>:id</code>や<code>:class</code>などのオプションをハッシュ形式で指定することもできます。</p><p><code>video_tag</code>の場合と同様、<code>audio_tag</code>にも以下の特殊オプションがあります。</p>
<ul>
<li>
<code>autoplay: true</code>はページ読み込み時に音声ファイルを再生します。</li>
<li>
<code>controls: true</code>は、ブラウザが提供する音声ファイル制御機能を使用できるようにします。</li>
<li>
<code>autobuffer: true</code>は、ページ読み込み時にすぐ再生できるように音声ファイルを事前に読み込んでおきます。</li>
</ul>
<h4 id="yieldを理解する"><a href="#yield%E3%82%92%E7%90%86%E8%A7%A3%E3%81%99%E3%82%8B">3.2 <code>yield</code>を理解する</a></h4><p><code>yield</code>メソッドは、レイアウトのコンテキストでビューを挿入すべき場所を指定するのに使用します。<code>yield</code>の最も単純な使用法は、<code>yield</code>を1つだけ使用して、現在レンダリングされているビューのコンテンツ全体をその場所に挿入するというものです。</p><div class="code_container">
<pre class="brush: plain; gutter: false; toolbar: false">
&lt;html&gt;
  &lt;head&gt;
  &lt;/head&gt;
  &lt;body&gt;
  &lt;%= yield %&gt;
  &lt;/body&gt;
&lt;/html&gt;

</pre>
</div>
<p><code>yield</code>を行なう領域を複数使用するレイアウトを作成することもできます。</p><div class="code_container">
<pre class="brush: plain; gutter: false; toolbar: false">
&lt;html&gt;
  &lt;head&gt;
  &lt;%= yield :head %&gt;
  &lt;/head&gt;
  &lt;body&gt;
  &lt;%= yield %&gt;
  &lt;/body&gt;
&lt;/html&gt;

</pre>
</div>
<p>ビューのメイン部分は常に「名前のない」<code>yield</code>としてレンダリングされます。コンテンツを名前付きの<code>yield</code>としてレンダリングするには、<code>content_for</code>メソッドを使用します。</p><h4 id="content-forを使用する"><a href="#content-for%E3%82%92%E4%BD%BF%E7%94%A8%E3%81%99%E3%82%8B">3.3 <code>content_for</code>を使用する</a></h4><p><code>content_for</code>メソッドを使用することで、コンテンツを名前付きの<code>yield</code>ブロックとしてレイアウトに挿入できます。たとえば、以下のビューのレンダリング結果は上で紹介したレイアウト内に挿入されます。</p><div class="code_container">
<pre class="brush: plain; gutter: false; toolbar: false">
&lt;% content_for :head do %&gt;
  &lt;title&gt;A simple page&lt;/title&gt;
&lt;% end %&gt;

&lt;p&gt;Hello, Rails!&lt;/p&gt;

</pre>
</div>
<p>このページのレンダリング結果がレイアウトに挿入されると、最終的に以下のHTMLが出力されます。</p><div class="code_container">
<pre class="brush: plain; gutter: false; toolbar: false">
&lt;html&gt;
  &lt;head&gt;
  &lt;title&gt;A simple page&lt;/title&gt;
  &lt;/head&gt;
  &lt;body&gt;
  &lt;p&gt;Hello, Rails!&lt;/p&gt;
  &lt;/body&gt;
&lt;/html&gt;

</pre>
</div>
<p><code>content_for</code>メソッドは、たとえばレイアウトが「サイドバー」や「フッター」などの領域に分かれていて、それらに異なるコンテンツを挿入したいような場合に大変便利です。あるいは、多くのページで使用する共通のヘッダーがあり、このヘッダーに特定のページでのみJavaScriptやCSSファイルを挿入したい場合にも便利です。</p><h4 id="パーシャルを使用する"><a href="#%E3%83%91%E3%83%BC%E3%82%B7%E3%83%A3%E3%83%AB%E3%82%92%E4%BD%BF%E7%94%A8%E3%81%99%E3%82%8B">3.4 パーシャルを使用する</a></h4><p>部分テンプレートは通常単にパーシャルと呼ばれます。パーシャルは、上とは異なる方法でレンダリング処理を扱いやすい単位に分割するためのしくみです。パーシャルを使用すると、レスポンスで表示するページの特定部分をレンダリングするためのコードを別ファイルに保存しておくことができます。</p><h5 id="パーシャルに名前を与える"><a href="#%E3%83%91%E3%83%BC%E3%82%B7%E3%83%A3%E3%83%AB%E3%81%AB%E5%90%8D%E5%89%8D%E3%82%92%E4%B8%8E%E3%81%88%E3%82%8B">3.4.1 パーシャルに名前を与える</a></h5><p>パーシャルをビューの一部に含めて出力するには、ビュー内で<code>render</code>メソッドを使用します。</p><div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
&lt;%= render "menu" %&gt;

</pre>
</div>
<p>レンダリング中のビュー内に置かれている上のコードは、その場所で<code>_menu.html.erb</code>という名前のファイルをレンダリングします。パーシャルファイル名の冒頭にはアンダースコアが付いていることにご注意ください。これは通常のビューと区別するために付けられています。ただしrenderで呼び出す際にはこのアンダースコアは不要です。以下のように、他のフォルダの下にあるパーシャルを呼び出す際にもアンダースコアは不要です。</p><div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
&lt;%= render "shared/menu" %&gt;

</pre>
</div>
<p>上のコードは、<code>app/views/shared/_menu.html.erb</code>パーシャルの内容をその場所でレンダリングします。</p><h5 id="シンプルなビューでパーシャルを使用する"><a href="#%E3%82%B7%E3%83%B3%E3%83%97%E3%83%AB%E3%81%AA%E3%83%93%E3%83%A5%E3%83%BC%E3%81%A7%E3%83%91%E3%83%BC%E3%82%B7%E3%83%A3%E3%83%AB%E3%82%92%E4%BD%BF%E7%94%A8%E3%81%99%E3%82%8B">3.4.2 シンプルなビューでパーシャルを使用する</a></h5><p>パーシャルの使用方法の1つは、パーシャルを一種のサブルーチンのようにみなすことです。詳細な表示内容をパーシャル化してビューから追い出し、コードを読みやすくします。例として、以下のようなビューがあるとします。</p><div class="code_container">
<pre class="brush: ruby; html-script: true; gutter: false; toolbar: false">
&lt;%= render "shared/ad_banner" %&gt;

&lt;h1&gt;Products&lt;/h1&gt;

&lt;p&gt;Here are a few of our fine products:&lt;/p&gt;
...

&lt;%= render "shared/footer" %&gt;

</pre>
</div>
<p>上のコードの<code>_ad_banner.html.erb</code>パーシャルと<code>_footer.html.erb</code>パーシャルに含まれるコンテンツは、アプリケーションの多くのページと共有できます。あるページを開発中、パーシャルの部分については詳細を気にせずに済みます。</p><div class="info"><p>すべてのページで共有されているコンテンツであれば、パーシャルをレイアウトで使用することができます。</p></div><h5 id="パーシャルレイアウト"><a href="#%E3%83%91%E3%83%BC%E3%82%B7%E3%83%A3%E3%83%AB%E3%83%AC%E3%82%A4%E3%82%A2%E3%82%A6%E3%83%88">3.4.3 パーシャルレイアウト</a></h5><p>ビューにレイアウトがあるのと同様、パーシャルでも独自のレイアウトファイルを使用することができます。たとえば、以下のようなパーシャルを呼び出すとします。</p><div class="code_container">
<pre class="brush: ruby; html-script: true; gutter: false; toolbar: false">
&lt;%= render partial: "link_area", layout: "graybar" %&gt;

</pre>
</div>
<p>上のコードは、<code>_link_area.html.erb</code>という名前のパーシャルを探し、<code>_graybar.html.erb</code>という名前のレイアウトを使用してレンダリングを行います。パーシャルレイアウトは、対応する通常のパーシャルと同様、名前の先頭にアンダースコアを追加する必要があります。そして、パーシャルとそれに対応するパーシャルレイアウトは同じディレクトリに置く必要があります。パーシャルレイアウトは<code>layouts</code>フォルダーには置けませんのでご注意ください。</p><p><code>:layout</code>などの追加オプションを渡す場合は、<code>:partial</code>オプションを明示的に指定する必要がある点にもご注意ください。</p><h5 id="ローカル変数を渡す"><a href="#%E3%83%AD%E3%83%BC%E3%82%AB%E3%83%AB%E5%A4%89%E6%95%B0%E3%82%92%E6%B8%A1%E3%81%99">3.4.4 ローカル変数を渡す</a></h5><p>パーシャルにローカル変数を引数として渡し、パーシャルをさらに強力かつ柔軟にすることもできます。たとえば、newページとeditページの違いがごくわずかしかないのであれば、この手法を使用してコードの重複を解消することができます。</p>
<ul>
<li>
<p><code>new.html.erb</code></p>
<div class="code_container">
<pre class="brush: plain; gutter: false; toolbar: false">
&lt;h1&gt;New zone&lt;/h1&gt;
&lt;%= render partial: "form", locals: {zone: @zone} %&gt;

</pre>
</div>
</li>
<li>
<p><code>edit.html.erb</code></p>
<div class="code_container">
<pre class="brush: plain; gutter: false; toolbar: false">
&lt;h1&gt;Editing zone&lt;/h1&gt;
&lt;%= render partial: "form", locals: {zone: @zone} %&gt;

</pre>
</div>
</li>
<li>
<p><code>_form.html.erb</code></p>
<div class="code_container">
<pre class="brush: plain; gutter: false; toolbar: false">
&lt;%= form_for(zone) do |f| %&gt;
  &lt;p&gt;
    &lt;b&gt;Zone name&lt;/b&gt;&lt;br&gt;
    &lt;%= f.text_field :name %&gt;
  &lt;/p&gt;
  &lt;p&gt;
    &lt;%= f.submit %&gt;
  &lt;/p&gt;
&lt;% end %&gt;

</pre>
</div>
</li>
</ul>
<p>上の2つのビューでは同じパーシャルがレンダリングされますが、Action Viewのsubmitヘルパーはnewアクションの場合には"Create Zone"を返し、editアクションの場合は"Update Zone"を返します。</p><p>どのパーシャルにも、パーシャル名からアンダースコアを取り除いた名前を持つローカル変数が与えられます。<code>:object</code>オプションを使用することで、このローカル変数にオブジェクトを渡すことができます。</p><div class="code_container">
<pre class="brush: ruby; html-script: true; gutter: false; toolbar: false">
&lt;%= render partial: "customer", object: @new_customer %&gt;

</pre>
</div>
<p>上の<code>customer</code>パーシャル呼び出しでは、<code>customer</code>ローカル変数は親のビューの<code>@new_customer</code>変数を指します。</p><p>あるモデルのインスタンスをパーシャルとしてレンダリングするのであれば、以下のような略記法を使用できます。</p><div class="code_container">
<pre class="brush: ruby; html-script: true; gutter: false; toolbar: false">
&lt;%= render @customer %&gt;

</pre>
</div>
<p>上のコードでは、<code>@customer</code>インスタンス変数に<code>Customer</code>モデルのインスタンスが含まれているとします。この場合レンダリングには<code>_customer.html.erb</code>パーシャルが使用され、このパーシャルには<code>customer</code>ローカル変数が渡されます。この<code>customer</code>ローカル変数は、親ビューにある<code>@customer</code>インスタンス変数を指します。</p><h5 id="コレクションをレンダリングする"><a href="#%E3%82%B3%E3%83%AC%E3%82%AF%E3%82%B7%E3%83%A7%E3%83%B3%E3%82%92%E3%83%AC%E3%83%B3%E3%83%80%E3%83%AA%E3%83%B3%E3%82%B0%E3%81%99%E3%82%8B">3.4.5 コレクションをレンダリングする</a></h5><p>パーシャルはデータの繰り返し (コレクション) を出力する場合にもきわめて便利です。<code>:collection</code>オプションを使用してパーシャルにコレクションを渡すと、コレクションのメンバごとにパーシャルがレンダリングされて挿入されます。</p>
<ul>
<li>
<p><code>index.html.erb</code></p>
<div class="code_container">
<pre class="brush: plain; gutter: false; toolbar: false">
&lt;h1&gt;Products&lt;/h1&gt;
&lt;%= render partial: "product", collection: @products %&gt;

</pre>
</div>
</li>
<li>
<p><code>_product.html.erb</code></p>
<div class="code_container">
<pre class="brush: plain; gutter: false; toolbar: false">
&lt;p&gt;Product Name: &lt;%= product.name %&gt;&lt;/p&gt;

</pre>
</div>
</li>
</ul>
<p>パーシャルを呼び出す時に指定するコレクションが複数形の場合、パーシャルの個別のインスタンスから、出力するコレクションの個別のメンバにアクセスが行われます。このとき、パーシャル名に基づいた名前を持つ変数が使用されます。上の場合、パーシャルの名前は<code>_product</code>であり、この<code>_product</code>パーシャル内で<code>product</code>という名前の変数を使用して、出力されるインスタンスを取得できます。</p><p>このメソッドには略記法もあります。<code>@products</code>が<code>product</code>インスタンスのコレクションであるとすると、<code>index.html.erb</code>に以下のように書くことで同じ結果を得られます。</p><div class="code_container">
<pre class="brush: plain; gutter: false; toolbar: false">
&lt;h1&gt;Products&lt;/h1&gt;
&lt;%= render @products %&gt;

</pre>
</div>
<p>使用するパーシャル名は、コレクション内のモデル名に基いて決定されます。実は、メンバが一様でない (さまざまな種類のメンバが入り混じった) コレクションにも上の方法を使用できます。この場合、コレクションのメンバに応じて適切なパーシャルが自動的に選択されます。</p>
<ul>
<li>
<p><code>index.html.erb</code></p>
<div class="code_container">
<pre class="brush: plain; gutter: false; toolbar: false">
&lt;h1&gt;Contacts&lt;/h1&gt;
&lt;%= render [customer1, employee1, customer2, employee2] %&gt;

</pre>
</div>
</li>
<li>
<p><code>customers/_customer.html.erb</code></p>
<div class="code_container">
<pre class="brush: plain; gutter: false; toolbar: false">
&lt;p&gt;Customer: &lt;%= customer.name %&gt;&lt;/p&gt;

</pre>
</div>
</li>
<li>
<p><code>employees/_employee.html.erb</code></p>
<div class="code_container">
<pre class="brush: plain; gutter: false; toolbar: false">
&lt;p&gt;Employee: &lt;%= employee.name %&gt;&lt;/p&gt;

</pre>
</div>
</li>
</ul>
<p>上のコードでは、コレクションのメンバに応じて、customerパーシャルまたはemployeeパーシャルが自動的に選択されます。</p><p>コレクションが空の場合、<code>render</code>はnilを返します。以下のような簡単な方法でもよいので、代わりのコンテンツを表示するようにしましょう。</p><div class="code_container">
<pre class="brush: plain; gutter: false; toolbar: false">
&lt;h1&gt;Products&lt;/h1&gt;
&lt;%= render(@products) || "There are no products available." %&gt;

</pre>
</div>
<h5 id="ローカル変数"><a href="#%E3%83%AD%E3%83%BC%E3%82%AB%E3%83%AB%E5%A4%89%E6%95%B0">3.4.6 ローカル変数</a></h5><p>パーシャル内のローカル変数をカスタマイズしたい場合は、パーシャルの呼び出し時に<code>:as</code>オプションを指定します。</p><div class="code_container">
<pre class="brush: ruby; html-script: true; gutter: false; toolbar: false">
&lt;%= render partial: "product", collection: @products, as: :item %&gt;

</pre>
</div>
<p>上のように変更することで、<code>@products</code>コレクションのインスタンスに<code>item</code>という名前のローカル変数経由でアクセスできます。</p><p><code>locals: {}</code>オプションを使用することで、レンダリング中のどのパーシャルにも任意の名前のローカル変数を渡すことができます。</p><div class="code_container">
<pre class="brush: ruby; html-script: true; gutter: false; toolbar: false">
&lt;%= render partial: "product", collection: @products,
           as: :item, locals: {title: "Products Page"} %&gt;

</pre>
</div>
<p>上の場合、<code>title</code>という名前のローカル変数に"Products Page"という値が含まれており、パーシャルからこの値にアクセスできます。</p><div class="info"><p>コレクションによって呼び出されるパーシャル内でカウンタ変数を使用することもできます。このカウンタ変数は、コレクション名の後ろに<code>_counter</code>を追加した名前になります。たとえば、パーシャル内で<code>@products</code>をレンダリングした回数を<code>product_counter</code>変数で参照できます。ただし、このオプションは<code>as: :value</code>オプションと併用できません。</p></div><p><code>:spacer_template</code>オプションを使用することで、メインパーシャルのインスタンスと交互にレンダリングされるセカンドパーシャルを指定することもできます。</p><h5 id="スペーサーテンプレート"><a href="#%E3%82%B9%E3%83%9A%E3%83%BC%E3%82%B5%E3%83%BC%E3%83%86%E3%83%B3%E3%83%97%E3%83%AC%E3%83%BC%E3%83%88">3.4.7 スペーサーテンプレート</a></h5><div class="code_container">
<pre class="brush: ruby; html-script: true; gutter: false; toolbar: false">
&lt;%= render partial: @products, spacer_template: "product_ruler" %&gt;

</pre>
</div>
<p>上のコードでは、<code>_product</code>パーシャルと<code>_product</code>パーシャルの合間に<code>_product_ruler</code>パーシャル (引数なし) をレンダリングします。</p><h5 id="コレクションパーシャルレイアウト"><a href="#%E3%82%B3%E3%83%AC%E3%82%AF%E3%82%B7%E3%83%A7%E3%83%B3%E3%83%91%E3%83%BC%E3%82%B7%E3%83%A3%E3%83%AB%E3%83%AC%E3%82%A4%E3%82%A2%E3%82%A6%E3%83%88">3.4.8 コレクションパーシャルレイアウト</a></h5><p>コレクションをレンダリングするときにも<code>:layout</code>オプションを指定できます。</p><div class="code_container">
<pre class="brush: ruby; html-script: true; gutter: false; toolbar: false">
&lt;%= render partial: "product", collection: @products, layout: "special_layout" %&gt;

</pre>
</div>
<p>このレイアウトは、コレクション内の各項目をレンダリングするたびに一緒にレンダリングされます。パーシャル内の場合と同様、このレイアウトでも現在のオブジェクトと(オブジェクト名)_counter変数を使用できます。</p><h4 id="ネストしたレイアウトを使用する"><a href="#%E3%83%8D%E3%82%B9%E3%83%88%E3%81%97%E3%81%9F%E3%83%AC%E3%82%A4%E3%82%A2%E3%82%A6%E3%83%88%E3%82%92%E4%BD%BF%E7%94%A8%E3%81%99%E3%82%8B">3.5 ネストしたレイアウトを使用する</a></h4><p>特定のコントローラをサポートするために、アプリケーションの標準レイアウトとの違いがごくわずかしかないようなレイアウトを使いたくなることがあります。ネストしたレイアウト (サブテンプレートと呼ばれることもあります) を使用することで、メインのレイアウトを複製して編集したりせずにこれを実現できます。例: </p><p>以下の<code>ApplicationController</code>レイアウトがあるとします。</p>
<ul>
<li>
<p><code>app/views/layouts/application.html.erb</code></p>
<div class="code_container">
<pre class="brush: plain; gutter: false; toolbar: false">
&lt;html&gt;
&lt;head&gt;
  &lt;title&gt;&lt;%= @page_title or "Page Title" %&gt;&lt;/title&gt;
  &lt;%= stylesheet_link_tag "layout" %&gt;
  &lt;style&gt;&lt;%= yield :stylesheets %&gt;&lt;/style&gt;
&lt;/head&gt;
&lt;body&gt;
  &lt;div id="top_menu"&gt;Top menu items here&lt;/div&gt;
  &lt;div id="menu"&gt;Menu items here&lt;/div&gt;
  &lt;div id="content"&gt;&lt;%= content_for?(:content) ? yield(:content) : yield %&gt;&lt;/div&gt;
&lt;/body&gt;
&lt;/html&gt;

</pre>
</div>
</li>
</ul>
<p><code>NewsController</code>によって生成されるページでは、トップメニューを隠して右メニューを追加したいとします。</p>
<ul>
<li>
<p><code>app/views/layouts/news.html.erb</code></p>
<div class="code_container">
<pre class="brush: plain; gutter: false; toolbar: false">
&lt;% content_for :stylesheets do %&gt;
  #top_menu {display: none}
  #right_menu {float: right; background-color: yellow; color: black}
&lt;% end %&gt;
&lt;% content_for :content do %&gt;
  &lt;div id="right_menu"&gt;Right menu items here&lt;/div&gt;
  &lt;%= content_for?(:news_content) ? yield(:news_content) : yield %&gt;
&lt;% end %&gt;
&lt;%= render template: "layouts/application" %&gt;

</pre>
</div>
</li>
</ul>
<p>以上でおしまいです。Newsビューで新しいレイアウトが使用されるようになり、トップメニューが隠されて"content" divタグ内に右メニューが新しく追加されました。</p><p>これと同じ結果を得られるサブテンプレートの使用法はこの他にもさまざまなものが考えられます。ネスティングレベルには制限がない点にご注目ください。たとえばNewsレイアウトで新しいレイアウトを使用するために、<code>render template: 'layouts/news'</code>経由で<code>ActionView::render</code>メソッドを使用することもできます。<code>News</code>レイアウトをサブテンプレート化するつもりがないのであれば、<code>content_for?(:news_content) ? yield(:news_content) : yield</code>を単に<code>yield</code>に置き換えれば済みます。</p>
        

        <h3 id="feedback"><a href="#feedback">フィードバックについて</a></h3>
        <p>
          本ガイドは GitHub上の <a href="https://github.com/yasslab/railsguides.jp">yasslab/railsguides.jp</a> で管理・公開されております。
          本ガイドを読んで気になる文章や間違ったコードを見かけたら、上記リポジトリにてお気軽に <a href="https://github.com/yasslab/railsguides.jp/issues">Issue</a> を出して頂けると嬉しいです。また、「Pull Request を送りたい!」という場合には、<a href="ruby_on_rails_guides_guidelines.html">Ruby on Railsガイドのガイドライン</a>と、<a href="https://github.com/yasslab/railsguides.jp#%E7%BF%BB%E8%A8%B3%E3%81%AE%E6%B5%81%E3%82%8C">README</a>に記載されている「翻訳の流れ」をご参考にしてください。
        </p>
        <p>
          なお、原著における間違いを見つけたら、「Ruby on Railsに貢献する方法」に記されている<a href="/contributing_to_ruby_on_rails.html#rails%E3%81%AE%E3%83%89%E3%82%AD%E3%83%A5%E3%83%A1%E3%83%B3%E3%83%88%E3%81%AB%E8%B2%A2%E7%8C%AE%E3%81%99%E3%82%8B">Railsのドキュメントに貢献する</a>を参考にしながら、ぜひRailsコミュニティに貢献してみてしてください :)
        </p>
        <p>
          本ガイドの品質向上に向けて、皆さまのご協力が得られれば幸いです。よろしくお願い致します。
        </p>
        <ol class="snsb" style="margin-left: 0px">
	  <li><div class="fb-like" data-href="http://railsguides.jp/" data-layout="button_count" data-action="like" data-show-faces="true" data-share="true"></div></li>
	  <li><a href="https://twitter.com/share" class="twitter-share-button" data-url="https://railsguides.jp/" data-text="Ruby on Rails ガイド：体系的に Rails を学ぼう" data-lang="en" data-hashtags="Railsガイド" data-via="RailsGuidesJP" width="100">Tweet</a><script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script></li>
          <li><a class="github-button" href="https://github.com/yasslab/railsguides.jp" data-count-href="/yasslab/railsguides.jp/stargazers" data-count-api="/repos/yasslab/railsguides.jp#stargazers_count" data-count-aria-label="# stargazers on GitHub" aria-label="Star yasslab/railsguides.jp on GitHub">Star</a></li>
          <li><a href="https://b.hatena.ne.jp/entry/railsguides.jp" class="hatena-bookmark-button" data-hatena-bookmark-title="Ruby on Rails ガイド：体系的に Rails を学ぼう" data-hatena-bookmark-layout="standard-balloon" data-hatena-bookmark-lang="ja" title="このエントリーをはてなブックマークに追加"><img src="https://b.st-hatena.com/images/entry-button/button-only@2x.png" alt="このエントリーをはてなブックマークに追加" width="20" height="20" style="border: none;" /></a><script type="text/javascript" src="https://b.st-hatena.com/js/bookmark_button.js" charset="utf-8" async="async"></script></li>          
	  <li><div class="g-plusone" data-size="medium" data-lang="ja"></div>
	    <script type="text/javascript">
	      (function() {
                var po = document.createElement('script'); po.type = 'text/javascript'; po.async = true;
                po.src = 'https://apis.google.com/js/plusone.js';
                var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(po, s);
	      })();
	    </script>
	  </li>
        </ol>
      </div>
    </div>
  </div>

  <hr class="hide" />
  <div id="footer">
    <div class="wrapper">
      <div class="sitemap">
          <dl class="L">
            <dt>はじめに</dt>
              <dd><a href="getting_started.html">Rails をはじめよう</a></dd>
            <dt>モデル</dt>
              <dd><a href="active_record_basics.html">Active Record の基礎</a></dd>
              <dd><a href="active_record_migrations.html">Active Record マイグレーション</a></dd>
              <dd><a href="active_record_validations.html">Active Record バリデーション</a></dd>
              <dd><a href="active_record_callbacks.html">Active Record コールバック</a></dd>
              <dd><a href="association_basics.html">Active Record の関連付け</a></dd>
              <dd><a href="active_record_querying.html">Active Record クエリインターフェイス</a></dd>
              <dd><a href="active_model_basics.html">Active Model の基礎</a></dd>
            <dt>ビュー</dt>
              <dd><a href="action_view_overview.html">Action View の概要</a></dd>
              <dd><a href="layouts_and_rendering.html">レイアウトとレンダリング</a></dd>
              <dd><a href="form_helpers.html">Action View フォームヘルパー</a></dd>
            <dt>コントローラ</dt>
              <dd><a href="action_controller_overview.html">Action Controller の概要</a></dd>
              <dd><a href="routing.html">Rails ルーティング</a></dd>
          </dl>
          <dl class="C">
            <dt>高度なトピック</dt>
              <dd><a href="active_support_core_extensions.html">Active Support コア拡張機能</a></dd>
              <dd><a href="i18n.html">Rails 国際化 (i18n) API</a></dd>
              <dd><a href="action_mailer_basics.html">Action Mailer の基礎</a></dd>
              <dd><a href="active_job_basics.html">Active Job の基礎</a></dd>
              <dd><a href="testing.html">Rails テスティングガイド</a></dd>
              <dd><a href="security.html">Rails セキュリティガイド</a></dd>
              <dd><a href="debugging_rails_applications.html">Rails アプリケーションのデバッグ</a></dd>
              <dd><a href="configuring.html">Rails アプリケーションを設定する</a></dd>
              <dd><a href="command_line.html">コマンドラインツールと Rake タスク</a></dd>
              <dd><a href="asset_pipeline.html">アセットパイプライン</a></dd>
              <dd><a href="working_with_javascript_in_rails.html">Rails で JavaScript を使用する</a></dd>
              <dd><a href="initialization.html">Rails の初期化プロセス</a></dd>
              <dd><a href="autoloading_and_reloading_constants.html">定数の自動読み込みと再読み込み</a></dd>
              <dd><a href="caching_with_rails.html">Rails のキャッシュ: 概要</a></dd>
              <dd><a href="active_support_instrumentation.html">Active Support の Instrumentation 機能</a></dd>
              <dd><a href="profiling.html">Rails アプリのプロファイリング</a></dd>
              <dd><a href="api_app.html">Rails による API 専用アプリ</a></dd>
              <dd><a href="action_cable_overview.html">Action Cable の概要</a></dd>
            <dt>Rails を拡張する</dt>
              <dd><a href="plugins.html">Rails プラグイン作成入門</a></dd>
              <dd><a href="rails_on_rack.html">Rails と Rack</a></dd>
              <dd><a href="generators.html">Rails ジェネレータとテンプレート入門</a></dd>
              <dd><a href="engines.html">Rails エンジン入門</a></dd>
          </dl>
          <dl class="R">
            <dt>Ruby on Rails に貢献する</dt>
              <dd><a href="contributing_to_ruby_on_rails.html">Ruby on Rails に貢献する方法</a></dd>
              <dd><a href="development_dependencies_install.html">Rails コア開発環境の構築方法</a></dd>
              <dd><a href="api_documentation_guidelines.html">API ドキュメント作成ガイドライン</a></dd>
              <dd><a href="ruby_on_rails_guides_guidelines.html">Rails ガイドのガイドライン</a></dd>
            <dt>メンテナンスポリシー</dt>
              <dd><a href="maintenance_policy.html">メンテナンスポリシー</a></dd>
            <dt>リリースノート</dt>
              <dd><a href="upgrading_ruby_on_rails.html">Rails アップグレードガイド</a></dd>
              <dd><a href="5_0_release_notes.html">Ruby on Rails 5.0 リリースノート</a></dd>
              <dd><a href="4_2_release_notes.html">Ruby on Rails 4.2 リリースノート</a></dd>
              <dd><a href="4_1_release_notes.html">Ruby on Rails 4.1 リリースノート</a></dd>
              <dd><a href="4_0_release_notes.html">Ruby on Rails 4.0 リリースノート</a></dd>
              <dd><a href="3_2_release_notes.html">Ruby on Rails 3.2 Release Notes [未着手]</a></dd>
              <dd><a href="3_1_release_notes.html">Ruby on Rails 3.1 Release Notes [未着手]</a></dd>
              <dd><a href="3_0_release_notes.html">Ruby on Rails 3.0 Release Notes [未着手]</a></dd>
              <dd><a href="2_3_release_notes.html">Ruby on Rails 2.3 Release Notes [未着手]</a></dd>
              <dd><a href="2_2_release_notes.html">Ruby on Rails 2.2 Release Notes [未着手]</a></dd>
          </dl>
      </div>

      <ol class="snsb" style="padding-top: 20px">
	<li>本ガイドは<a href="https://creativecommons.org/licenses/by-sa/4.0/deed.ja">クリエイティブ・コモンズ 表示-継承 4.0 国際</a> (CC BY-SA 4.0) ライセンスに基づいて公開されています。また、「Rails」および「Ruby on Rails」という名称、そして Rails のロゴは、David Heinemeier Hansson による登録商標で、すべての権利を有しています。</li>
      </ol>
    </div>
  </div>
</h5>
  <script type="text/javascript" src="javascripts/jquery.min.js"></script>
  <script type="text/javascript" src="javascripts/responsive-tables.js"></script>
  <script type="text/javascript" src="javascripts/guides.js"></script>
  <script type="text/javascript" src="javascripts/syntaxhighlighter/shCore.js"></script>
  <script type="text/javascript" src="javascripts/syntaxhighlighter/shBrushRuby.js"></script>
  <script type="text/javascript" src="javascripts/syntaxhighlighter/shBrushXml.js"></script>
  <script type="text/javascript" src="javascripts/syntaxhighlighter/shBrushSql.js"></script>
  <script type="text/javascript" src="javascripts/syntaxhighlighter/shBrushPlain.js"></script>
  <script type="text/javascript">
    SyntaxHighlighter.all();
    $(guidesIndex.bind);
  </script>
  <script async defer src="https://buttons.github.io/buttons.js"></script>
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-50163209-4', 'auto');
    ga('send', 'pageview');
  </script>
</body>
</html>
